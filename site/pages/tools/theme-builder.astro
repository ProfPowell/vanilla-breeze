---
/**
 * Theme Builder
 *
 * Interactive tool for creating and customizing Vanilla Breeze themes.
 * Adjust colors, typography, shapes, shadows, and motion in real-time.
 */
import DocsLayout from '../../layouts/DocsLayout.astro';

// Available preset themes
const presetThemes = [
  { id: 'default', name: 'Default', category: 'base' },
  { id: 'ocean', name: 'Ocean', category: 'color' },
  { id: 'forest', name: 'Forest', category: 'color' },
  { id: 'sunset', name: 'Sunset', category: 'color' },
  { id: 'modern', name: 'Modern', category: 'personality' },
  { id: 'minimal', name: 'Minimal', category: 'personality' },
  { id: 'classic', name: 'Classic', category: 'personality' },
  { id: 'brutalist', name: 'Brutalist', category: 'extreme' },
  { id: 'swiss', name: 'Swiss', category: 'extreme' },
  { id: 'cyber', name: 'Cyber', category: 'extreme' },
  { id: 'organic', name: 'Organic', category: 'extreme' },
  { id: 'editorial', name: 'Editorial', category: 'extreme' },
  { id: 'terminal', name: 'Terminal', category: 'extreme' },
  { id: 'kawaii', name: 'Kawaii', category: 'extreme' },
  { id: '8bit', name: '8-bit', category: 'extreme' },
];
---

<DocsLayout
  title="Theme Builder"
  description="Create and customize Vanilla Breeze themes with this interactive builder. Adjust colors, typography, shapes, and more."
  currentSection="docs"
>
  <h1>Theme Builder</h1>
  <p class="lead">Create custom themes by adjusting design tokens in real-time. See your changes instantly in the preview panel.</p>

  <div class="theme-builder">
    <!-- Controls Panel -->
    <aside class="controls-panel">
      <!-- Theme Presets -->
      <section class="control-section">
        <h2>Presets</h2>
        <div class="preset-groups">
          <div class="preset-group">
            <h3>Base</h3>
            <div class="preset-buttons">
              {presetThemes.filter(t => t.category === 'base').map(theme => (
                <button type="button" class="preset-btn" data-theme={theme.id}>{theme.name}</button>
              ))}
            </div>
          </div>
          <div class="preset-group">
            <h3>Color</h3>
            <div class="preset-buttons">
              {presetThemes.filter(t => t.category === 'color').map(theme => (
                <button type="button" class="preset-btn" data-theme={theme.id}>{theme.name}</button>
              ))}
            </div>
          </div>
          <div class="preset-group">
            <h3>Personality</h3>
            <div class="preset-buttons">
              {presetThemes.filter(t => t.category === 'personality').map(theme => (
                <button type="button" class="preset-btn" data-theme={theme.id}>{theme.name}</button>
              ))}
            </div>
          </div>
          <div class="preset-group">
            <h3>Extreme</h3>
            <div class="preset-buttons">
              {presetThemes.filter(t => t.category === 'extreme').map(theme => (
                <button type="button" class="preset-btn" data-theme={theme.id}>{theme.name}</button>
              ))}
            </div>
          </div>
        </div>
      </section>

      <!-- Mode Toggle -->
      <section class="control-section">
        <h2>Mode</h2>
        <div class="mode-toggle">
          <button type="button" class="mode-btn active" data-mode="light">Light</button>
          <button type="button" class="mode-btn" data-mode="dark">Dark</button>
          <button type="button" class="mode-btn" data-mode="auto">Auto</button>
        </div>
      </section>

      <!-- Color Controls -->
      <section class="control-section">
        <h2>Colors</h2>
        <div class="control-grid">
          <label class="control-item">
            <span class="control-label">Primary Hue</span>
            <input type="range" min="0" max="360" value="250" data-token="--hue-primary" class="hue-slider" />
            <span class="control-value" data-for="--hue-primary">250</span>
          </label>
          <label class="control-item">
            <span class="control-label">Secondary Hue</span>
            <input type="range" min="0" max="360" value="200" data-token="--hue-secondary" class="hue-slider" />
            <span class="control-value" data-for="--hue-secondary">200</span>
          </label>
          <label class="control-item">
            <span class="control-label">Accent Hue</span>
            <input type="range" min="0" max="360" value="45" data-token="--hue-accent" class="hue-slider" />
            <span class="control-value" data-for="--hue-accent">45</span>
          </label>
          <label class="control-item">
            <span class="control-label">Primary Saturation</span>
            <input type="range" min="0" max="0.4" step="0.01" value="0.15" data-token="--saturation-primary" />
            <span class="control-value" data-for="--saturation-primary">0.15</span>
          </label>
        </div>
      </section>

      <!-- Shape Controls -->
      <section class="control-section">
        <h2>Shape</h2>
        <div class="control-grid">
          <label class="control-item">
            <span class="control-label">Border Radius Scale</span>
            <input type="range" min="0" max="2" step="0.1" value="1" data-token="--radius-scale" />
            <span class="control-value" data-for="--radius-scale">1</span>
          </label>
          <label class="control-item">
            <span class="control-label">Radius S</span>
            <input type="range" min="0" max="1" step="0.05" value="0.25" data-token="--radius-s-value" />
            <span class="control-value" data-for="--radius-s-value">0.25rem</span>
          </label>
          <label class="control-item">
            <span class="control-label">Radius M</span>
            <input type="range" min="0" max="2" step="0.05" value="0.5" data-token="--radius-m-value" />
            <span class="control-value" data-for="--radius-m-value">0.5rem</span>
          </label>
          <label class="control-item">
            <span class="control-label">Radius L</span>
            <input type="range" min="0" max="3" step="0.1" value="0.75" data-token="--radius-l-value" />
            <span class="control-value" data-for="--radius-l-value">0.75rem</span>
          </label>
        </div>
      </section>

      <!-- Shadow Controls -->
      <section class="control-section">
        <h2>Shadows</h2>
        <div class="control-grid">
          <label class="control-item">
            <span class="control-label">Shadow Intensity</span>
            <input type="range" min="0" max="2" step="0.1" value="1" data-token="--shadow-intensity" />
            <span class="control-value" data-for="--shadow-intensity">1</span>
          </label>
          <label class="control-item">
            <span class="control-label">Shadow Blur</span>
            <input type="range" min="0" max="3" step="0.1" value="1" data-token="--shadow-blur" />
            <span class="control-value" data-for="--shadow-blur">1</span>
          </label>
          <label class="control-item">
            <span class="control-label">Shadow Offset Y</span>
            <input type="range" min="0" max="3" step="0.1" value="1" data-token="--shadow-offset" />
            <span class="control-value" data-for="--shadow-offset">1</span>
          </label>
        </div>
      </section>

      <!-- Typography Controls -->
      <section class="control-section">
        <h2>Typography</h2>
        <div class="control-grid">
          <label class="control-item">
            <span class="control-label">Font Family</span>
            <select data-token="--font-family">
              <option value="system-ui, -apple-system, sans-serif">System UI</option>
              <option value="'Inter', system-ui, sans-serif">Inter</option>
              <option value="'Helvetica Neue', Helvetica, Arial, sans-serif">Helvetica</option>
              <option value="Georgia, 'Times New Roman', serif">Georgia (Serif)</option>
              <option value="ui-monospace, 'Cascadia Code', monospace">Monospace</option>
            </select>
          </label>
          <label class="control-item">
            <span class="control-label">Base Font Size</span>
            <input type="range" min="14" max="20" step="1" value="16" data-token="--font-size-base-px" />
            <span class="control-value" data-for="--font-size-base-px">16px</span>
          </label>
          <label class="control-item">
            <span class="control-label">Line Height</span>
            <input type="range" min="1.2" max="2" step="0.05" value="1.5" data-token="--line-height" />
            <span class="control-value" data-for="--line-height">1.5</span>
          </label>
        </div>
      </section>

      <!-- Motion Controls -->
      <section class="control-section">
        <h2>Motion</h2>
        <div class="control-grid">
          <label class="control-item">
            <span class="control-label">Duration Scale</span>
            <input type="range" min="0" max="3" step="0.1" value="1" data-token="--duration-scale" />
            <span class="control-value" data-for="--duration-scale">1x</span>
          </label>
          <label class="control-item">
            <span class="control-label">Easing</span>
            <select data-token="--ease-type">
              <option value="ease">Ease (Default)</option>
              <option value="ease-out">Ease Out</option>
              <option value="ease-in-out">Ease In-Out</option>
              <option value="linear">Linear</option>
              <option value="cubic-bezier(0.34, 1.56, 0.64, 1)">Bouncy</option>
            </select>
          </label>
        </div>
      </section>

      <!-- Export -->
      <section class="control-section">
        <h2>Export</h2>
        <div class="export-buttons">
          <button type="button" id="copy-css" class="export-btn primary">Copy CSS</button>
          <button type="button" id="download-css" class="export-btn">Download CSS</button>
          <button type="button" id="reset-theme" class="export-btn outline">Reset</button>
        </div>
      </section>
    </aside>

    <!-- Preview Panel -->
    <div class="preview-panel" id="preview-panel">
      <div class="preview-content">
        <!-- Typography Preview -->
        <section class="preview-section">
          <h2>Typography</h2>
          <h1>Heading 1</h1>
          <h2>Heading 2</h2>
          <h3>Heading 3</h3>
          <h4>Heading 4</h4>
          <p>Body text looks like this. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
          <p><a href="#">This is a link</a> and <code>this is inline code</code>.</p>
        </section>

        <!-- Buttons Preview -->
        <section class="preview-section">
          <h2>Buttons</h2>
          <layout-cluster data-layout-gap="s">
            <button type="button" class="primary">Primary</button>
            <button type="button" class="secondary">Secondary</button>
            <button type="button" class="outline">Outline</button>
            <button type="button" disabled>Disabled</button>
          </layout-cluster>
        </section>

        <!-- Cards Preview -->
        <section class="preview-section">
          <h2>Cards</h2>
          <layout-grid data-layout-min="200px" data-layout-gap="m">
            <layout-card>
              <layout-stack data-layout-gap="s">
                <h3 style="margin: 0;">Card Title</h3>
                <p style="margin: 0; color: var(--color-text-muted);">Card description with some content.</p>
                <button type="button" class="primary">Action</button>
              </layout-stack>
            </layout-card>
            <layout-card>
              <layout-stack data-layout-gap="s">
                <h3 style="margin: 0;">Another Card</h3>
                <p style="margin: 0; color: var(--color-text-muted);">More content goes here.</p>
                <button type="button" class="outline">Learn More</button>
              </layout-stack>
            </layout-card>
          </layout-grid>
        </section>

        <!-- Form Preview -->
        <section class="preview-section">
          <h2>Form Elements</h2>
          <form id="demo-form">
            <layout-stack data-layout-gap="m">
              <label>
                <span>Text Input</span>
                <input type="text" placeholder="Enter text..." />
              </label>
              <label>
                <span>Select</span>
                <select>
                  <option>Option 1</option>
                  <option>Option 2</option>
                  <option>Option 3</option>
                </select>
              </label>
              <label>
                <span>Textarea</span>
                <textarea placeholder="Enter longer text..."></textarea>
              </label>
              <layout-cluster data-layout-gap="m">
                <label class="checkbox-label">
                  <input type="checkbox" checked />
                  <span>Checkbox</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="radio-demo" checked />
                  <span>Radio A</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="radio-demo" />
                  <span>Radio B</span>
                </label>
              </layout-cluster>
            </layout-stack>
          </form>
        </section>

        <!-- Colors Preview -->
        <section class="preview-section">
          <h2>Colors</h2>
          <layout-cluster data-layout-gap="s">
            <div class="color-swatch" style="background: var(--color-primary);" title="Primary"></div>
            <div class="color-swatch" style="background: var(--color-secondary);" title="Secondary"></div>
            <div class="color-swatch" style="background: var(--color-accent);" title="Accent"></div>
            <div class="color-swatch" style="background: var(--color-success);" title="Success"></div>
            <div class="color-swatch" style="background: var(--color-warning);" title="Warning"></div>
            <div class="color-swatch" style="background: var(--color-error);" title="Error"></div>
          </layout-cluster>
          <layout-cluster data-layout-gap="s" style="margin-top: var(--size-s);">
            <div class="color-swatch" style="background: var(--color-surface);" title="Surface"></div>
            <div class="color-swatch" style="background: var(--color-surface-raised);" title="Surface Raised"></div>
            <div class="color-swatch" style="background: var(--color-border);" title="Border"></div>
            <div class="color-swatch" style="background: var(--color-text);" title="Text"></div>
            <div class="color-swatch" style="background: var(--color-text-muted);" title="Text Muted"></div>
          </layout-cluster>
        </section>

        <!-- Blockquote -->
        <section class="preview-section">
          <h2>Blockquote</h2>
          <blockquote>
            <p>"Design is not just what it looks like and feels like. Design is how it works."</p>
            <cite>Steve Jobs</cite>
          </blockquote>
        </section>

        <!-- Code Block -->
        <section class="preview-section">
          <h2>Code</h2>
          <pre><code>function greet(name) &#123;
  return 'Hello, ' + name + '!';
&#125;

console.log(greet('World'));</code></pre>
        </section>
      </div>
    </div>
  </div>

  <!-- CSS Output Modal -->
  <dialog id="css-modal">
    <article>
      <header>
        <h2>Generated CSS</h2>
        <button type="button" id="close-modal" aria-label="Close">Ã—</button>
      </header>
      <pre><code id="css-output"></code></pre>
      <footer>
        <button type="button" id="modal-copy" class="primary">Copy to Clipboard</button>
      </footer>
    </article>
  </dialog>
</DocsLayout>

<style>
  .theme-builder {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: var(--size-l);
    margin-block: var(--size-l);
    min-block-size: 80vh;
  }

  @media (max-width: 900px) {
    .theme-builder {
      grid-template-columns: 1fr;
    }
  }

  /* Controls Panel */
  .controls-panel {
    background: var(--color-surface);
    border: var(--border-width-thin) solid var(--color-border);
    border-radius: var(--radius-m);
    padding: var(--size-m);
    overflow-y: auto;
    max-block-size: calc(100vh - 200px);
    position: sticky;
    top: var(--size-m);
  }

  .control-section {
    padding-block-end: var(--size-m);
    border-block-end: var(--border-width-thin) solid var(--color-border);
    margin-block-end: var(--size-m);
  }

  .control-section:last-child {
    border-block-end: none;
    margin-block-end: 0;
    padding-block-end: 0;
  }

  .control-section h2 {
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    margin-block-end: var(--size-s);
  }

  .control-grid {
    display: flex;
    flex-direction: column;
    gap: var(--size-s);
  }

  .control-item {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--size-xs);
    align-items: center;
  }

  .control-label {
    font-size: var(--font-size-sm);
    grid-column: 1 / -1;
  }

  .control-item input[type="range"] {
    grid-column: 1;
    width: 100%;
  }

  .control-item select {
    grid-column: 1 / -1;
    width: 100%;
  }

  .control-value {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    font-family: var(--font-mono);
    min-inline-size: 4ch;
    text-align: end;
  }

  /* Preset Buttons */
  .preset-groups {
    display: flex;
    flex-direction: column;
    gap: var(--size-s);
  }

  .preset-group h3 {
    font-size: var(--font-size-xs);
    color: var(--color-text-subtle);
    margin-block-end: var(--size-2xs);
  }

  .preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--size-2xs);
  }

  .preset-btn {
    padding: var(--size-2xs) var(--size-xs);
    font-size: var(--font-size-xs);
    border: var(--border-width-thin) solid var(--color-border);
    background: var(--color-surface);
    border-radius: var(--radius-s);
    cursor: pointer;
    transition: all 0.15s;
  }

  .preset-btn:hover {
    border-color: var(--color-interactive);
    color: var(--color-interactive);
  }

  .preset-btn.active {
    background: var(--color-interactive);
    color: white;
    border-color: var(--color-interactive);
  }

  /* Mode Toggle */
  .mode-toggle {
    display: flex;
    gap: var(--size-2xs);
  }

  .mode-btn {
    flex: 1;
    padding: var(--size-xs);
    font-size: var(--font-size-sm);
    border: var(--border-width-thin) solid var(--color-border);
    background: var(--color-surface);
    border-radius: var(--radius-s);
    cursor: pointer;
    transition: all 0.15s;
  }

  .mode-btn:hover {
    border-color: var(--color-interactive);
  }

  .mode-btn.active {
    background: var(--color-interactive);
    color: white;
    border-color: var(--color-interactive);
  }

  /* Export Buttons */
  .export-buttons {
    display: flex;
    flex-direction: column;
    gap: var(--size-xs);
  }

  .export-btn {
    width: 100%;
    padding: var(--size-s);
    font-size: var(--font-size-sm);
    border: var(--border-width-thin) solid var(--color-border);
    background: var(--color-surface);
    border-radius: var(--radius-s);
    cursor: pointer;
    transition: all 0.15s;
  }

  .export-btn.primary {
    background: var(--color-interactive);
    color: white;
    border-color: var(--color-interactive);
  }

  .export-btn.primary:hover {
    background: var(--color-interactive-hover);
  }

  .export-btn.outline:hover {
    border-color: var(--color-error);
    color: var(--color-error);
  }

  /* Preview Panel */
  .preview-panel {
    background: var(--color-background);
    border: var(--border-width-thin) solid var(--color-border);
    border-radius: var(--radius-m);
    overflow: hidden;
  }

  .preview-content {
    padding: var(--size-l);
  }

  .preview-section {
    margin-block-end: var(--size-xl);
    padding-block-end: var(--size-xl);
    border-block-end: var(--border-width-thin) solid var(--color-border);
  }

  .preview-section:last-child {
    border-block-end: none;
    margin-block-end: 0;
    padding-block-end: 0;
  }

  .preview-section > h2 {
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    margin-block-end: var(--size-m);
  }

  /* Color Swatches */
  .color-swatch {
    inline-size: 48px;
    block-size: 48px;
    border-radius: var(--radius-s);
    border: var(--border-width-thin) solid var(--color-border);
  }

  /* Hue Slider Track */
  .hue-slider {
    appearance: none;
    background: linear-gradient(
      to right,
      oklch(65% 0.2 0),
      oklch(65% 0.2 60),
      oklch(65% 0.2 120),
      oklch(65% 0.2 180),
      oklch(65% 0.2 240),
      oklch(65% 0.2 300),
      oklch(65% 0.2 360)
    );
    height: 8px;
    border-radius: var(--radius-s);
  }

  .hue-slider::-webkit-slider-thumb {
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: white;
    border: 2px solid var(--color-border);
    box-shadow: var(--shadow-sm);
    cursor: pointer;
  }

  /* Modal */
  dialog {
    border: none;
    border-radius: var(--radius-l);
    padding: 0;
    max-inline-size: 600px;
    inline-size: 90vw;
    box-shadow: var(--shadow-xl);
  }

  dialog::backdrop {
    background: oklch(0% 0 0 / 0.5);
  }

  dialog article {
    display: flex;
    flex-direction: column;
    max-block-size: 80vh;
  }

  dialog header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--size-m);
    border-block-end: var(--border-width-thin) solid var(--color-border);
  }

  dialog header h2 {
    margin: 0;
    font-size: var(--font-size-lg);
  }

  dialog header button {
    background: none;
    border: none;
    font-size: var(--font-size-xl);
    cursor: pointer;
    color: var(--color-text-muted);
    padding: var(--size-xs);
  }

  dialog pre {
    margin: 0;
    padding: var(--size-m);
    overflow: auto;
    flex: 1;
    font-size: var(--font-size-sm);
    background: var(--color-surface);
  }

  dialog footer {
    padding: var(--size-m);
    border-block-start: var(--border-width-thin) solid var(--color-border);
    display: flex;
    justify-content: flex-end;
  }

  /* Checkbox/Radio labels */
  .checkbox-label,
  .radio-label {
    display: flex;
    align-items: center;
    gap: var(--size-xs);
    cursor: pointer;
  }
</style>

<script>
  // Theme Builder Logic
  class ThemeBuilder {
    constructor() {
      this.previewPanel = document.getElementById('preview-panel');
      this.cssModal = document.getElementById('css-modal');
      this.cssOutput = document.getElementById('css-output');
      this.currentTheme = 'default';
      this.currentMode = 'light';
      this.customTokens = {};

      this.init();
    }

    init() {
      // Preset buttons
      document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', () => this.applyPreset(btn.dataset.theme));
      });

      // Mode buttons
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => this.setMode(btn.dataset.mode));
      });

      // Range and select inputs
      document.querySelectorAll('.controls-panel input[type="range"], .controls-panel select').forEach(input => {
        input.addEventListener('input', () => this.updateToken(input));
      });

      // Export buttons
      document.getElementById('copy-css')?.addEventListener('click', () => this.showCSSModal());
      document.getElementById('download-css')?.addEventListener('click', () => this.downloadCSS());
      document.getElementById('reset-theme')?.addEventListener('click', () => this.reset());

      // Modal controls
      document.getElementById('close-modal')?.addEventListener('click', () => this.cssModal?.close());
      document.getElementById('modal-copy')?.addEventListener('click', () => this.copyToClipboard());

      // Set initial active state
      this.updateActivePreset('default');
    }

    applyPreset(themeId) {
      this.currentTheme = themeId;

      // Remove any existing theme
      if (themeId === 'default') {
        this.previewPanel?.removeAttribute('data-theme');
      } else {
        this.previewPanel?.setAttribute('data-theme', themeId);
      }

      // Clear custom tokens when switching presets
      this.customTokens = {};
      this.previewPanel?.removeAttribute('style');

      this.updateActivePreset(themeId);
    }

    updateActivePreset(themeId) {
      document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === themeId);
      });
    }

    setMode(mode) {
      this.currentMode = mode;

      if (mode === 'auto') {
        this.previewPanel?.removeAttribute('data-mode');
      } else {
        this.previewPanel?.setAttribute('data-mode', mode);
      }

      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });
    }

    updateToken(input) {
      const token = input.dataset.token;
      const value = input.value;

      // Update display value
      const valueDisplay = document.querySelector(`[data-for="${token}"]`);
      if (valueDisplay) {
        let displayValue = value;
        if (token.includes('radius') && token !== '--radius-scale') {
          displayValue = `${value}rem`;
        } else if (token === '--font-size-base-px') {
          displayValue = `${value}px`;
        } else if (token === '--duration-scale') {
          displayValue = `${value}x`;
        }
        valueDisplay.textContent = displayValue;
      }

      // Store custom token
      this.customTokens[token] = value;

      // Apply to preview panel
      this.applyCustomTokens();
    }

    applyCustomTokens() {
      let styleString = '';

      for (const [token, value] of Object.entries(this.customTokens)) {
        switch (token) {
          case '--hue-primary':
            styleString += `--color-primary: oklch(50% 0.15 ${value}); `;
            styleString += `--color-interactive: oklch(50% 0.15 ${value}); `;
            break;
          case '--hue-secondary':
            styleString += `--color-secondary: oklch(50% 0.1 ${value}); `;
            break;
          case '--hue-accent':
            styleString += `--color-accent: oklch(65% 0.15 ${value}); `;
            break;
          case '--saturation-primary':
            // Re-apply with current hue
            const hue = this.customTokens['--hue-primary'] || 250;
            styleString += `--color-primary: oklch(50% ${value} ${hue}); `;
            break;
          case '--radius-s-value':
            styleString += `--radius-s: ${value}rem; `;
            break;
          case '--radius-m-value':
            styleString += `--radius-m: ${value}rem; `;
            break;
          case '--radius-l-value':
            styleString += `--radius-l: ${value}rem; `;
            break;
          case '--shadow-intensity':
            const intensity = parseFloat(value);
            styleString += `--shadow-sm: 0 2px ${4 * intensity}px oklch(0% 0 0 / ${0.1 * intensity}); `;
            styleString += `--shadow-md: 0 4px ${8 * intensity}px oklch(0% 0 0 / ${0.12 * intensity}); `;
            styleString += `--shadow-lg: 0 8px ${16 * intensity}px oklch(0% 0 0 / ${0.15 * intensity}); `;
            break;
          case '--font-family':
            styleString += `--font-sans: ${value}; `;
            break;
          case '--font-size-base-px':
            styleString += `font-size: ${value}px; `;
            break;
          case '--line-height':
            styleString += `--line-height-normal: ${value}; `;
            break;
          case '--duration-scale':
            const scale = parseFloat(value);
            styleString += `--duration-fast: ${Math.round(100 * scale)}ms; `;
            styleString += `--duration-normal: ${Math.round(200 * scale)}ms; `;
            styleString += `--duration-slow: ${Math.round(400 * scale)}ms; `;
            break;
          case '--ease-type':
            styleString += `--ease-default: ${value}; `;
            break;
        }
      }

      if (this.previewPanel) {
        this.previewPanel.style.cssText = styleString;
      }
    }

    generateCSS() {
      const themeName = 'custom';
      let css = `/* Custom Vanilla Breeze Theme */\n`;
      css += `:root[data-theme="${themeName}"],\n`;
      css += `[data-theme="${themeName}"] {\n`;

      // Add customized tokens
      for (const [token, value] of Object.entries(this.customTokens)) {
        switch (token) {
          case '--hue-primary':
            css += `  --hue-primary: ${value};\n`;
            css += `  --color-primary: oklch(50% 0.15 ${value});\n`;
            break;
          case '--hue-secondary':
            css += `  --hue-secondary: ${value};\n`;
            css += `  --color-secondary: oklch(50% 0.1 ${value});\n`;
            break;
          case '--hue-accent':
            css += `  --hue-accent: ${value};\n`;
            css += `  --color-accent: oklch(65% 0.15 ${value});\n`;
            break;
          case '--radius-s-value':
            css += `  --radius-s: ${value}rem;\n`;
            break;
          case '--radius-m-value':
            css += `  --radius-m: ${value}rem;\n`;
            break;
          case '--radius-l-value':
            css += `  --radius-l: ${value}rem;\n`;
            break;
          case '--font-family':
            css += `  --font-sans: ${value};\n`;
            break;
          case '--line-height':
            css += `  --line-height-normal: ${value};\n`;
            break;
        }
      }

      css += `}\n`;

      // Note about base theme
      if (this.currentTheme !== 'default') {
        css = `/* Based on: ${this.currentTheme} theme */\n` + css;
      }

      return css;
    }

    showCSSModal() {
      const css = this.generateCSS();
      if (this.cssOutput) {
        this.cssOutput.textContent = css;
      }
      this.cssModal?.showModal();
    }

    downloadCSS() {
      const css = this.generateCSS();
      const blob = new Blob([css], { type: 'text/css' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'custom-theme.css';
      a.click();
      URL.revokeObjectURL(url);
    }

    async copyToClipboard() {
      const css = this.generateCSS();
      try {
        await navigator.clipboard.writeText(css);
        const btn = document.getElementById('modal-copy');
        if (btn) {
          const originalText = btn.textContent;
          btn.textContent = 'Copied!';
          setTimeout(() => {
            btn.textContent = originalText;
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    }

    reset() {
      this.customTokens = {};
      this.previewPanel?.removeAttribute('style');
      this.applyPreset('default');
      this.setMode('light');

      // Reset all inputs to defaults
      document.querySelectorAll('.controls-panel input[type="range"]').forEach(input => {
        input.value = input.defaultValue;
        const valueDisplay = document.querySelector(`[data-for="${input.dataset.token}"]`);
        if (valueDisplay) {
          valueDisplay.textContent = input.defaultValue;
        }
      });

      document.querySelectorAll('.controls-panel select').forEach(select => {
        select.selectedIndex = 0;
      });
    }
  }

  // Initialize on page load
  new ThemeBuilder();

  // Prevent demo form submission
  document.getElementById('demo-form')?.addEventListener('submit', (e) => e.preventDefault());
</script>
