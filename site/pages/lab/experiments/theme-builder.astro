---
/**
 * Theme Builder Experiment
 *
 * Interactive theme creation with live CSS variable updates.
 */

import LabLayout from '../../../layouts/LabLayout.astro';
---

<LabLayout
  title="Theme Builder"
  description="Build and preview custom themes with live CSS variable updates."
>
  <layout-center>
    <layout-stack>
      <nav class="breadcrumb">
        <a href="/lab/">Lab</a>
        <span>/</span>
        <a href="/lab/experiments/">Experiments</a>
        <span>/</span>
        <span>Theme Builder</span>
      </nav>

      <header>
        <h1>Theme Builder</h1>
        <p class="intro">
          Build and preview custom themes by adjusting CSS variables in real-time.
          Export your theme as CSS when done.
        </p>
      </header>

      <div class="builder-layout">
        <aside class="controls-panel">
          <h2>Colors</h2>
          <div class="control-group">
            <label for="color-primary">Primary</label>
            <input type="color" id="color-primary" value="#3b82f6" />
          </div>
          <div class="control-group">
            <label for="color-bg">Background</label>
            <input type="color" id="color-bg" value="#ffffff" />
          </div>
          <div class="control-group">
            <label for="color-text">Text</label>
            <input type="color" id="color-text" value="#1e293b" />
          </div>

          <h2>Spacing</h2>
          <div class="control-group">
            <label for="radius">Border Radius</label>
            <input type="range" id="radius" min="0" max="24" value="8" />
            <span class="range-value">8px</span>
          </div>

          <button class="export-btn" id="export-btn">Export CSS</button>
        </aside>

        <main class="preview-area">
          <div class="preview-card">
            <h3>Preview Card</h3>
            <p>This card updates in real-time as you adjust the theme settings.</p>
            <button class="preview-button">Primary Button</button>
          </div>

          <div class="preview-card">
            <h3>Another Component</h3>
            <p>All components share the same design tokens.</p>
            <div class="preview-tags">
              <span class="tag">Tag 1</span>
              <span class="tag">Tag 2</span>
              <span class="tag">Tag 3</span>
            </div>
          </div>
        </main>
      </div>
    </layout-stack>
  </layout-center>
</LabLayout>

<style>
  nav.breadcrumb {
    display: flex;
    gap: var(--size-xs);
    font-size: var(--size-s);
    color: var(--color-text-muted);
    margin-block-end: var(--size-l);
  }

  nav.breadcrumb a {
    color: var(--color-primary);
    text-decoration: none;
  }

  header {
    margin-block-end: var(--size-xl);
  }

  h1 {
    font-size: var(--size-2xl);
    margin-block-end: var(--size-s);
  }

  .intro {
    font-size: var(--size-m);
    color: var(--color-text-muted);
    max-width: 60ch;
  }

  .builder-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: var(--size-l);
  }

  @media (width < 768px) {
    .builder-layout {
      grid-template-columns: 1fr;
    }
  }

  .controls-panel {
    padding: var(--size-l);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-m);
    height: fit-content;
  }

  .controls-panel h2 {
    font-size: var(--size-s);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0 0 var(--size-m) 0;
  }

  .controls-panel h2:not(:first-child) {
    margin-top: var(--size-l);
    padding-top: var(--size-l);
    border-top: 1px solid var(--color-border);
  }

  .control-group {
    margin-block-end: var(--size-m);
  }

  .control-group label {
    display: block;
    font-size: var(--size-s);
    margin-block-end: var(--size-2xs);
  }

  .control-group input[type="color"] {
    width: 100%;
    height: 40px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-s);
    cursor: pointer;
  }

  .control-group input[type="range"] {
    width: 100%;
  }

  .range-value {
    font-size: var(--size-s);
    color: var(--color-text-muted);
  }

  .export-btn {
    width: 100%;
    padding: var(--size-s) var(--size-m);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-s);
    cursor: pointer;
    font-family: inherit;
    font-weight: 500;
    margin-top: var(--size-l);
  }

  .preview-area {
    display: grid;
    gap: var(--size-m);
  }

  .preview-card {
    padding: var(--size-l);
    background: var(--builder-bg, var(--color-surface));
    border: 1px solid var(--color-border);
    border-radius: var(--builder-radius, var(--radius-m));
    color: var(--builder-text, var(--color-text));
  }

  .preview-card h3 {
    margin: 0 0 var(--size-s) 0;
  }

  .preview-card p {
    margin: 0 0 var(--size-m) 0;
    color: var(--builder-text, var(--color-text-muted));
    opacity: 0.8;
  }

  .preview-button {
    padding: var(--size-s) var(--size-m);
    background: var(--builder-primary, var(--color-primary));
    color: white;
    border: none;
    border-radius: var(--builder-radius, var(--radius-s));
    cursor: pointer;
    font-family: inherit;
  }

  .preview-tags {
    display: flex;
    gap: var(--size-xs);
  }

  .tag {
    padding: var(--size-2xs) var(--size-s);
    background: var(--builder-primary, var(--color-primary));
    color: white;
    border-radius: var(--builder-radius, var(--radius-s));
    font-size: var(--size-s);
    opacity: 0.8;
  }
</style>

<script>
  const colorPrimary = document.getElementById('color-primary') as HTMLInputElement;
  const colorBg = document.getElementById('color-bg') as HTMLInputElement;
  const colorText = document.getElementById('color-text') as HTMLInputElement;
  const radius = document.getElementById('radius') as HTMLInputElement;
  const radiusValue = document.querySelector('.range-value');
  const previewArea = document.querySelector('.preview-area') as HTMLElement;

  function updatePreview() {
    previewArea.style.setProperty('--builder-primary', colorPrimary.value);
    previewArea.style.setProperty('--builder-bg', colorBg.value);
    previewArea.style.setProperty('--builder-text', colorText.value);
    previewArea.style.setProperty('--builder-radius', `${radius.value}px`);
    if (radiusValue) radiusValue.textContent = `${radius.value}px`;
  }

  colorPrimary?.addEventListener('input', updatePreview);
  colorBg?.addEventListener('input', updatePreview);
  colorText?.addEventListener('input', updatePreview);
  radius?.addEventListener('input', updatePreview);

  document.getElementById('export-btn')?.addEventListener('click', () => {
    const css = `/* Custom Theme */
:root {
  --color-primary: ${colorPrimary.value};
  --color-background: ${colorBg.value};
  --color-text: ${colorText.value};
  --radius-m: ${radius.value}px;
}`;
    navigator.clipboard.writeText(css);
    alert('CSS copied to clipboard!');
  });
</script>
