---
/**
 * Tooltip Documentation
 *
 * Title-first progressive enhancement tooltips with four tiers:
 * Tier 1: title + data-tooltip (simple text)
 * Tier 2: data-tooltip="id" referencing a popover (rich HTML)
 * Tier 3: tooltip-wc card variant (hover cards)
 * Tier 0: Pure interestfor (advanced, zero-JS)
 */
import ElementLayout from '../../../../layouts/ElementLayout.astro';

// --- Tier 1: Simple text tooltip from title ---

const basicUsageCode = `<!-- No JS: native browser tooltip shows "This is a tooltip!" -->
<!-- With JS: title removed, styled popover tooltip created -->
<button title="This is a tooltip!" data-tooltip>Hover me</button>`;

const positionCode = `<button title="Tooltip appears above" data-tooltip>Top</button>

<button title="Tooltip appears below" data-tooltip data-tooltip-position="bottom">Bottom</button>

<button title="Tooltip appears on the left" data-tooltip data-tooltip-position="left">Left</button>

<button title="Tooltip appears on the right" data-tooltip data-tooltip-position="right">Right</button>`;

const elementTypesCode = `<!-- On a link -->
<a href="#" title="Links can have tooltips too!" data-tooltip>Hover this link</a>

<!-- On an icon button -->
<button type="button" class="ghost" aria-label="Settings"
        title="Open settings" data-tooltip data-tooltip-position="bottom">
  <icon-wc name="settings"></icon-wc>
</button>

<!-- On text with tabindex -->
<span tabindex="0" title="Additional information about this feature"
      data-tooltip style="text-decoration: underline dotted; cursor: help;">
  What's this?
</span>`;

// --- Tier 2: Rich HTML tooltip ---

const richContentCode = `<button type="button" title="Save (Ctrl+S)" data-tooltip="save-tip">
  <icon-wc name="save" size="sm"></icon-wc>
  Save
</button>
<div id="save-tip" popover="hint" role="tooltip">
  <strong>Save document</strong><br>
  <kbd>Ctrl</kbd> + <kbd>S</kbd>
  <span class="tooltip-arrow" aria-hidden="true"></span>
</div>`;

const richContentSecondaryCode = `<button type="button" title="Copy to clipboard" data-tooltip="copy-tip">
  Copy
</button>
<div id="copy-tip" popover="hint" role="tooltip">
  Copy to clipboard<br>
  <small>Copied items expire after 24 hours</small>
  <span class="tooltip-arrow" aria-hidden="true"></span>
</div>`;

// --- Tier 3: Card variant (tooltip-wc) ---

const cardProfileCode = `<tooltip-wc data-variant="card">
  <a href="/user/jane" data-trigger>Jane Smith</a>
  <div data-content>
    <div style="display: flex; align-items: center; gap: var(--size-s);">
      <user-avatar data-size="lg">
        <span data-fallback>JS</span>
      </user-avatar>
      <div>
        <strong>Jane Smith</strong>
        <span class="text-muted" style="display: block;">
          Senior Developer
        </span>
      </div>
    </div>
    <span class="text-muted"
          style="display: block; margin-block-start: var(--size-xs);">
      <icon-wc name="map-pin" size="xs"></icon-wc> San Francisco
      &middot; 142 contributions
    </span>
  </div>
</tooltip-wc>`;

const cardPreviewCode = `<tooltip-wc data-variant="card">
  <a href="/docs/elements/native/dialog/" data-trigger>dialog element</a>
  <div data-content>
    <div style="display: flex; gap: var(--size-s); align-items: start;">
      <icon-wc name="layout-template" size="lg"
        style="color: var(--color-interactive); flex-shrink: 0;">
      </icon-wc>
      <div>
        <strong>Dialog Element</strong>
        <span class="text-muted"
              style="display: block; margin-block-start: var(--size-2xs);">
          Native modal and non-modal dialogs with backdrop,
          keyboard handling, and focus management.
        </span>
      </div>
    </div>
  </div>
</tooltip-wc>`;

// --- Tier 3: tooltip-wc with title PE ---

const tooltipWcTitleCode = `<!-- Progressive enhancement: title provides no-JS fallback -->
<tooltip-wc>
  <button type="button" title="Save your changes">Save</button>
  <template data-tooltip>
    <strong>Save document</strong><br>
    <kbd>Ctrl</kbd> + <kbd>S</kbd>
  </template>
</tooltip-wc>`;

// --- Tier 0: Pure interestfor ---

const interestforCode = `<!-- Pure HTML tooltip — no init script needed -->
<button interestfor="wai-def">WAI-ARIA</button>
<div id="wai-def" popover="hint">
  Web Accessibility Initiative – Accessible Rich Internet Applications
</div>`;

const interestforStylingCode = `/* Custom timing via CSS custom properties */
#my-tooltip \{
  --interest-delay-start: 300ms;
  --interest-delay-end: 150ms;
\}`;

// --- tooltip-wc specifics ---

const delayCode = `<tooltip-wc data-tooltip-delay="0">
  <button>Instant</button>
  <template data-tooltip>Shows immediately</template>
</tooltip-wc>

<tooltip-wc data-tooltip-delay="500">
  <button>Delayed</button>
  <template data-tooltip>Waits 500ms</template>
</tooltip-wc>`;

const eventCode = `const tooltip = document.querySelector('tooltip-wc');

tooltip.addEventListener('tooltip-show', () => \{
  console.log('Tooltip shown');
\});

tooltip.addEventListener('tooltip-hide', () => \{
  console.log('Tooltip hidden');
\});`;

const apiCode = `const tooltip = document.querySelector('tooltip-wc');

// Show the tooltip
tooltip.show();

// Check visibility
console.log(tooltip.isVisible); // true

// Hide the tooltip
tooltip.hide();`;
---

<ElementLayout
  title="Tooltips"
  description="Progressive enhancement tooltips: native title fallback upgraded to styled popovers with arrows and positioning."
  elementName="tooltip-wc"
  category="component"
  currentPath="/docs/elements/web-components/tooltip/"
>
  <section>
    <h2>Overview</h2>
    <p>Tooltips use a <strong>title-first progressive enhancement</strong> approach. The <code>title</code> attribute provides a no-JS fallback (native browser tooltip). When JavaScript loads, the init script reads the title, removes it, and creates a styled popover with arrows and positioning.</p>

    <browser-window
      src="/docs/examples/demos/tooltip-basic.html"
      url="https://vanilla-breeze.dev/tooltip"
      title="Tooltip"
      shadow>
    </browser-window>

    <code-block language="html" show-lines label="Simple tooltip with title + data-tooltip">{basicUsageCode}</code-block>

    <h3>Progressive Enhancement</h3>
    <table class="props-table">
      <thead>
        <tr>
          <th>State</th>
          <th>What the user sees</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>No JavaScript</td>
          <td>Native browser tooltip from <code>title</code> attribute</td>
        </tr>
        <tr>
          <td>JavaScript loaded</td>
          <td>Styled popover with arrow, positioned via CSS Anchor or JS fallback</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>Simple Text Tooltip (Tier 1)</h2>
    <p>Add <code>title</code> and <code>data-tooltip</code> (no value) to any element. The init script creates the popover automatically.</p>

    <h3>Positions</h3>
    <p>Use <code>data-tooltip-position</code> to control where the tooltip appears relative to the trigger.</p>

    <browser-window src="/docs/examples/demos/tooltip-positions.html" style="min-height: 10rem;" shadow></browser-window>

    <code-block language="html" show-lines label="Tooltip position variants">{positionCode}</code-block>

    <h3>With Different Elements</h3>
    <p>Tooltips work on any focusable element: buttons, links, and elements with <code>tabindex</code>.</p>

    <browser-window src="/docs/examples/demos/tooltip-elements.html" style="min-height: 8rem;" shadow></browser-window>

    <code-block language="html" show-lines label="Tooltips on different element types">{elementTypesCode}</code-block>

    <h3>Attributes</h3>
    <table class="props-table">
      <thead>
        <tr>
          <th>Attribute</th>
          <th>On</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>title</code></td>
          <td>trigger</td>
          <td>Tooltip text. Read by init script and removed to prevent native double-tooltip.</td>
        </tr>
        <tr>
          <td><code>data-tooltip</code></td>
          <td>trigger</td>
          <td>Marker for init script discovery. No value = create from title. With value = reference popover by ID.</td>
        </tr>
        <tr>
          <td><code>data-tooltip-position</code></td>
          <td>trigger</td>
          <td>Position: <code>top</code> (default), <code>bottom</code>, <code>left</code>, or <code>right</code>.</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>Rich HTML Tooltip (Tier 2)</h2>
    <p>For tooltips with formatted content (keyboard shortcuts, icons, multiple lines), use <code>data-tooltip="id"</code> to reference an existing popover element. The <code>title</code> provides a plain-text no-JS fallback.</p>

    <browser-window src="/docs/examples/demos/tooltip-rich.html" style="min-height: 8rem;" shadow></browser-window>

    <code-block language="html" show-lines label="Rich tooltip with keyboard shortcut">{richContentCode}</code-block>

    <code-block language="html" show-lines label="Tooltip with secondary info">{richContentSecondaryCode}</code-block>
  </section>

  <section>
    <h2>Card Variant (Tier 3)</h2>
    <p>For richer content previews like user profiles or link previews, use <code>&lt;tooltip-wc data-variant="card"&gt;</code>. Cards use <code>popover="manual"</code> for interactive content and have longer show/hide delays.</p>

    <browser-window src="/docs/examples/demos/tooltip-cards.html" style="min-height: 12rem;" shadow></browser-window>

    <code-block language="html" show-lines label="User profile hover card">{cardProfileCode}</code-block>

    <code-block language="html" show-lines label="Link preview hover card">{cardPreviewCode}</code-block>

    <h3>Differences from Regular Tooltip</h3>
    <table class="props-table">
      <thead>
        <tr>
          <th>Feature</th>
          <th>Tooltip (Tier 1/2)</th>
          <th>Card variant</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Content model</td>
          <td><code>title</code> or <code>data-tooltip="id"</code></td>
          <td><code>[data-trigger]</code> + <code>[data-content]</code></td>
        </tr>
        <tr>
          <td>Appearance</td>
          <td>Dark, compact, with arrow</td>
          <td>Light card surface, border, shadow, no arrow</td>
        </tr>
        <tr>
          <td>Show delay</td>
          <td>200ms</td>
          <td>300ms</td>
        </tr>
        <tr>
          <td>Hide delay</td>
          <td>100ms</td>
          <td>200ms</td>
        </tr>
        <tr>
          <td>Popover type</td>
          <td><code>hint</code></td>
          <td><code>manual</code> (supports interactive content)</td>
        </tr>
        <tr>
          <td>ARIA</td>
          <td><code>role="tooltip"</code>, <code>aria-describedby</code></td>
          <td>None (supplementary content)</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>tooltip-wc with Title Fallback</h2>
    <p>The <code>&lt;tooltip-wc&gt;</code> component also reads <code>title</code> from its trigger as a content source (lowest priority after <code>&lt;template data-tooltip&gt;</code> and <code>data-content</code>). This gives progressive enhancement to the web component path too.</p>

    <div class="example">
      <layout-cluster data-layout-gap="l">
        <tooltip-wc>
          <button type="button" title="Save your changes">Save</button>
          <template data-tooltip>
            <strong>Save document</strong><br>
            <kbd>Ctrl</kbd> + <kbd>S</kbd>
          </template>
        </tooltip-wc>
      </layout-cluster>
    </div>

    <code-block language="html" show-lines label="tooltip-wc with title fallback">{tooltipWcTitleCode}</code-block>

    <p>Content priority in <code>tooltip-wc</code>:</p>
    <ol>
      <li><code>&lt;template data-tooltip&gt;</code> (rich HTML)</li>
      <li><code>data-content</code> attribute (plain text, backward compatible)</li>
      <li><code>title</code> on trigger (PE baseline — read and removed)</li>
    </ol>
  </section>

  <section>
    <h2>Pure HTML Tooltips — <code>interestfor</code> (Tier 0)</h2>
    <p>For simple tooltips that don't need arrows, custom positioning, or rich content, you can skip the init script entirely. The <code>interestfor</code> attribute (native in Chrome 133+, polyfilled in other browsers) handles hover/focus timing and popover show/hide declaratively.</p>

    <div class="example">
      <layout-cluster data-layout-gap="l">
        <span>
          The
          <button interestfor="wai-def-demo" style="all: unset; cursor: help; text-decoration: underline dotted; text-underline-offset: 3px;">WAI-ARIA</button>
          specification defines accessible rich internet applications.
        </span>
        <div id="wai-def-demo" popover="hint">
          Web Accessibility Initiative &ndash; Accessible Rich Internet Applications
        </div>
      </layout-cluster>
    </div>

    <code-block language="html" show-lines label="Pure HTML tooltip with interestfor">{interestforCode}</code-block>

    <h3>Custom Timing</h3>
    <p>Control show/hide delays with CSS custom properties:</p>
    <code-block language="css" show-lines label="Custom timing">{interestforStylingCode}</code-block>
  </section>

  <section>
    <h2>When to Use Which</h2>
    <table class="props-table">
      <thead>
        <tr>
          <th>Use case</th>
          <th>Approach</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Simple text hint on a button/link</td>
          <td><code>title</code> + <code>data-tooltip</code> (Tier 1)</td>
        </tr>
        <tr>
          <td>Rich content (kbd shortcuts, icons)</td>
          <td><code>data-tooltip="id"</code> referencing a popover (Tier 2)</td>
        </tr>
        <tr>
          <td>Interactive hover card (profiles, previews)</td>
          <td><code>&lt;tooltip-wc data-variant="card"&gt;</code> (Tier 3)</td>
        </tr>
        <tr>
          <td>Zero-JS inline definition</td>
          <td><code>interestfor</code> + <code>popover="hint"</code> (Tier 0)</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>How It Works</h2>

    <h3>Popover API</h3>
    <p>Tooltips use the native <a href="https://developer.mozilla.org/en-US/docs/Web/API/Popover_API">Popover API</a> with <code>popover="hint"</code>. This renders tooltips in the browser's top layer, avoiding z-index conflicts and overflow clipping issues.</p>

    <h3>CSS Anchor Positioning</h3>
    <p>In modern browsers (Chrome 125+, Safari 18+), tooltips use <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_anchor_positioning">CSS Anchor Positioning</a> for smooth, hardware-accelerated positioning. Older browsers fall back to JavaScript positioning automatically.</p>

    <h3>Browser Support</h3>
    <table class="props-table">
      <thead>
        <tr>
          <th>Browser</th>
          <th>Positioning</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Chrome 125+</td>
          <td>CSS Anchor</td>
          <td>Full support</td>
        </tr>
        <tr>
          <td>Safari 18+</td>
          <td>CSS Anchor</td>
          <td>Full support</td>
        </tr>
        <tr>
          <td>Firefox</td>
          <td>JS Fallback</td>
          <td>Anchor positioning not yet supported</td>
        </tr>
        <tr>
          <td>Older browsers</td>
          <td>JS Fallback</td>
          <td>Requires Popover API support</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>Show Delay (<code>tooltip-wc</code>)</h2>
    <p>When using <code>&lt;tooltip-wc&gt;</code>, control how long to wait before showing with <code>data-tooltip-delay</code>. Default is 200ms.</p>

    <browser-window src="/docs/examples/demos/tooltip-delay.html" style="min-height: 8rem;" shadow></browser-window>

    <code-block language="html" show-lines label="Configuring show delay">{delayCode}</code-block>
  </section>

  <section>
    <h2>Events &amp; API (<code>tooltip-wc</code>)</h2>

    <h3>Events</h3>
    <table class="props-table">
      <thead>
        <tr>
          <th>Event</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>tooltip-show</code></td>
          <td>Fired when the tooltip becomes visible.</td>
        </tr>
        <tr>
          <td><code>tooltip-hide</code></td>
          <td>Fired when the tooltip is hidden.</td>
        </tr>
      </tbody>
    </table>

    <code-block language="javascript" show-lines label="Listening for tooltip events">{eventCode}</code-block>

    <h3>JavaScript API</h3>
    <table class="props-table">
      <thead>
        <tr>
          <th>Method/Property</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>show()</code></td>
          <td>method</td>
          <td>Show the tooltip immediately.</td>
        </tr>
        <tr>
          <td><code>hide()</code></td>
          <td>method</td>
          <td>Hide the tooltip immediately.</td>
        </tr>
        <tr>
          <td><code>isVisible</code></td>
          <td>property</td>
          <td>Read-only boolean indicating if the tooltip is currently visible.</td>
        </tr>
      </tbody>
    </table>

    <code-block language="javascript" show-lines label="Programmatic tooltip control">{apiCode}</code-block>
  </section>

  <section>
    <h2>Keyboard Support</h2>
    <p>Tooltips appear on keyboard focus and can be dismissed with the Escape key. Escape handling is built into the Popover API.</p>

    <table class="props-table">
      <thead>
        <tr>
          <th>Key</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><kbd>Tab</kbd></td>
          <td>Focus the trigger element, showing the tooltip</td>
        </tr>
        <tr>
          <td><kbd>Escape</kbd></td>
          <td>Hide the tooltip while keeping focus on the trigger</td>
        </tr>
      </tbody>
    </table>

    <div class="example">
      <p>Use Tab to focus the button below, then press Escape to hide the tooltip:</p>
      <button title="Press Escape to dismiss this tooltip" data-tooltip>Focus me with Tab</button>
    </div>
  </section>

  <section>
    <h2>Accessibility</h2>

    <h3>ARIA Attributes</h3>
    <ul>
      <li>The tooltip has <code>role="tooltip"</code> and <code>popover="hint"</code></li>
      <li>The trigger gets <code>aria-describedby</code> pointing to the tooltip (set by init script)</li>
      <li>The tooltip arrow has <code>aria-hidden="true"</code></li>
      <li>Uses the browser's top layer for proper stacking without z-index conflicts</li>
    </ul>

    <h3>Screen Reader Behavior</h3>
    <p>When the trigger receives focus, screen readers announce the element followed by the tooltip content (via <code>aria-describedby</code>). This provides context without requiring visual interaction.</p>

    <h3>Best Practices</h3>
    <ul>
      <li>Keep tooltip content brief and informative</li>
      <li>Don't put essential information only in tooltips</li>
      <li>Ensure the trigger element is focusable</li>
      <li>Use tooltips for supplementary information, not primary content</li>
      <li>Avoid interactive content inside tooltips (use cards instead)</li>
    </ul>
  </section>
</ElementLayout>
