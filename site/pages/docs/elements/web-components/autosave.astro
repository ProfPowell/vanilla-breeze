---
/**
 * Form Autosave Documentation
 *
 * Draft persistence using localStorage with data-autosave attribute.
 */
import ElementLayout from '../../../../layouts/ElementLayout.astro';

const basicCode = `<form data-autosave="contact-form">
  <input name="name" placeholder="Name">
  <textarea name="message" placeholder="Message"></textarea>
  <button type="submit">Send</button>
</form>`;

const fullCode = `<form data-autosave="registration">
  <form-field>
    <label for="name">Name</label>
    <input type="text" id="name" name="name">
  </form-field>

  <form-field>
    <label for="email">Email</label>
    <input type="email" id="email" name="email">
  </form-field>

  <!-- Password fields are automatically skipped -->
  <form-field>
    <label for="pw">Password</label>
    <input type="password" id="pw" name="pw">
  </form-field>

  <form-field>
    <label for="bio">Bio</label>
    <textarea id="bio" name="bio" data-grow data-count
      maxlength="500"></textarea>
  </form-field>

  <button type="submit">Register</button>
  <button type="reset">Clear Draft</button>
</form>`;
---

<ElementLayout
  title="Form Autosave"
  description="Persist form drafts to localStorage. Restore on page reload. Clear on submit or reset."
  elementName="data-autosave"
  category="component"
  currentPath="/docs/elements/web-components/autosave/"
>
  <section>
    <h2>Overview</h2>
    <p>Add <code>data-autosave="key"</code> to a <code>&lt;form&gt;</code> to automatically save its data to <code>localStorage</code> as the user types. On page reload, the draft is restored and a &ldquo;Draft restored&rdquo; toast notification appears. Drafts are cleared on submit or reset, and expire after 24 hours.</p>

    <browser-window
      src="/docs/examples/demos/autosave-basic.html"
      url="https://vanilla-breeze.dev/autosave"
      title="Form Autosave Demo"
      shadow>
    </browser-window>
  </section>

  <section>
    <h2>Basic Usage</h2>
    <p>The <code>data-autosave</code> value is the storage key. Use unique keys for different forms.</p>

    <code-block language="html" show-lines label="Basic autosave">{basicCode}</code-block>
  </section>

  <section>
    <h2>Full Example</h2>
    <p>Works with all VB form enhancements &mdash; <code>data-grow</code>, <code>data-count</code>, <code>form-field</code>, etc.</p>

    <code-block language="html" show-lines label="Full form with autosave">{fullCode}</code-block>
  </section>

  <section>
    <h2>Attributes</h2>
    <table class="props-table">
      <thead>
        <tr>
          <th>Attribute</th>
          <th>On</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>data-autosave</code></td>
          <td><code>&lt;form&gt;</code></td>
          <td>Storage key for this form's draft. Must be unique per form.</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>Behavior</h2>
    <ul>
      <li><strong>Save:</strong> Debounced (500ms) on every <code>input</code> and <code>change</code> event</li>
      <li><strong>Restore:</strong> On page load, if a non-expired draft exists</li>
      <li><strong>Clear:</strong> On form <code>submit</code> or <code>reset</code></li>
      <li><strong>Expire:</strong> Drafts older than 24 hours are discarded</li>
      <li><strong>Skip:</strong> Password and file inputs are never saved</li>
      <li><strong>Notify:</strong> Shows a &ldquo;Draft restored&rdquo; toast via <code>&lt;toast-wc&gt;</code> if available</li>
    </ul>
  </section>

  <section>
    <h2>Storage</h2>
    <p>Data is stored in <code>localStorage</code> under the key <code>vb-autosave:&lt;your-key&gt;</code>. The stored JSON includes a timestamp for expiry checking. The reset button clears both the form fields and the stored draft.</p>
  </section>

  <section>
    <h2>Progressive Enhancement</h2>
    <ul>
      <li><strong>No JS:</strong> Form works normally with no persistence. No user-facing difference.</li>
      <li><strong>With JS:</strong> Drafts are saved and restored automatically.</li>
      <li><strong>No localStorage:</strong> Silently fails. No errors, just no persistence.</li>
    </ul>
  </section>

  <section>
    <h2>Related Elements</h2>
    <ul>
      <li><a href="/docs/elements/web-components/toast/"><code>&lt;toast-wc&gt;</code></a> &mdash; Used for &ldquo;Draft restored&rdquo; notification</li>
      <li><a href="/docs/elements/custom-elements/form-field/"><code>&lt;form-field&gt;</code></a> &mdash; Form field wrapper</li>
      <li><a href="/docs/elements/native/form/"><code>&lt;form&gt;</code></a> &mdash; Native form element</li>
    </ul>
  </section>
</ElementLayout>
