---
/**
 * data-animate-image Attribute Documentation
 *
 * Play/pause control for animated images (GIF, WebP, APNG).
 */
import DocsLayout from '../../../layouts/DocsLayout.astro';

const basicCode = `<img src="animation.gif" data-animate-image alt="Animated demo">`;

const startPausedCode = `<img src="animation.gif" data-animate-image data-animate-image-paused alt="Paused by default">`;

const reducedMotionCode = `/* The init script checks for reduced motion preference:
 *
 * 1. prefers-reduced-motion: reduce (OS setting)
 * 2. data-motion-reduced attribute on <html>
 *
 * If either is true, the image is auto-paused after
 * the first frame is captured. The user can still
 * click the play button to resume manually.
 */`;

const howItWorksCode = `<!-- Before enhancement -->
<img src="animation.gif" data-animate-image alt="Demo">

<!-- After enhancement (auto-generated wrapper) -->
<div class="animate-image-wrapper">
  <img src="animation.gif" data-animate-image data-animate-image-init alt="Demo">
  <button type="button" class="animate-image-toggle" aria-label="Pause animation"></button>
</div>`;

const dynamicCode = `// Dynamically added images are auto-enhanced via MutationObserver
const img = document.createElement('img');
img.src = 'animation.gif';
img.alt = 'Dynamic animation';
img.dataset.animateImage = '';
document.body.appendChild(img);
// img is wrapped and enhanced automatically â€” no manual init needed`;
---

<DocsLayout
  title="data-animate-image"
  description="Play/pause control for animated images. Add data-animate-image to any GIF, WebP, or APNG for a toggle button with automatic reduced-motion support."
  currentSection="api"
>
  <h1>data-animate-image</h1>
  <p class="lead">Play/pause control for animated images. Add <code>data-animate-image</code> to any GIF, WebP, or APNG for a toggle button with automatic reduced-motion support.</p>

  <heading-links data-levels="h2,h3">
  <section>
    <h2>Overview</h2>
    <p>The <code>data-animate-image</code> attribute adds a play/pause toggle button to animated images. Users can stop distracting animations with a single click, and the image automatically pauses when <code>prefers-reduced-motion</code> is active.</p>

    <code-block language="html" show-lines label="Basic usage">{basicCode}</code-block>
  </section>

  <section>
    <h2>How It Works</h2>
    <ol>
      <li>The init script wraps the <code>&lt;img&gt;</code> in a <code>.animate-image-wrapper</code> container for positioning</li>
      <li>A toggle <code>&lt;button&gt;</code> is injected alongside the image</li>
      <li>On load, the first frame is captured to a canvas and converted to a static PNG data URL</li>
      <li>When paused, the image <code>src</code> is swapped to the static frame; when played, it reverts to the original animated source</li>
      <li>The <code>data-animate-image-paused</code> attribute tracks the paused state</li>
    </ol>

    <code-block language="html" show-lines label="Before and after enhancement">{howItWorksCode}</code-block>
  </section>

  <section>
    <h2>Attributes</h2>
    <table class="props-table">
      <thead>
        <tr>
          <th>Attribute</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>data-animate-image</code></td>
          <td>boolean</td>
          <td>Marks an <code>&lt;img&gt;</code> for animation control enhancement.</td>
        </tr>
        <tr>
          <td><code>data-animate-image-paused</code></td>
          <td>boolean</td>
          <td>Set initially to start the image paused. Also set/removed automatically when the user toggles playback.</td>
        </tr>
        <tr>
          <td><code>data-animate-image-init</code></td>
          <td>boolean</td>
          <td>Set automatically to prevent double-binding. Do not set manually.</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>Start Paused</h2>
    <p>Add <code>data-animate-image-paused</code> to the image to start it in a paused state. The first frame is captured on load and displayed as a static image until the user clicks play.</p>

    <code-block language="html" show-lines label="Start paused">{startPausedCode}</code-block>
  </section>

  <section>
    <h2>Reduced Motion</h2>
    <p>The init script automatically pauses animated images when the user has requested reduced motion. This is detected via two mechanisms:</p>

    <ul>
      <li><code>prefers-reduced-motion: reduce</code> &mdash; the OS-level media query</li>
      <li><code>data-motion-reduced</code> attribute on <code>&lt;html&gt;</code> &mdash; for app-level motion controls</li>
    </ul>

    <p>When either is active, images are auto-paused after the first frame is captured. The user can still manually play the animation using the toggle button.</p>

    <p>Runtime changes to the <code>prefers-reduced-motion</code> media query are also detected &mdash; if the user enables reduced motion while viewing the page, animated images will pause automatically.</p>

    <code-block language="javascript" show-lines label="Reduced motion handling">{reducedMotionCode}</code-block>
  </section>

  <section>
    <h2>Dynamic Elements</h2>
    <p>Images added to the DOM after page load are automatically enhanced via a MutationObserver. No manual initialization is needed.</p>

    <code-block language="javascript" show-lines label="Dynamically added animated images">{dynamicCode}</code-block>
  </section>

  <section>
    <h2>Accessibility</h2>
    <ul>
      <li>The toggle button has an <code>aria-label</code> that updates to "Pause animation" or "Play animation" based on state</li>
      <li>Respects <code>prefers-reduced-motion: reduce</code> by auto-pausing &mdash; users who find motion distracting see a static image by default</li>
      <li>Also respects a page-level <code>data-motion-reduced</code> attribute on <code>&lt;html&gt;</code></li>
      <li>The toggle button is keyboard-accessible (focusable, activated with Enter/Space)</li>
      <li>Without JavaScript, the image displays normally &mdash; progressive enhancement ensures the animated content is never lost</li>
      <li>Falls back gracefully for cross-origin images where canvas capture may be blocked by CORS</li>
    </ul>
  </section>

  </heading-links>
</DocsLayout>
