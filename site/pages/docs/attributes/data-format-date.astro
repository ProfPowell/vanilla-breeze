---
/**
 * data-format-date Attribute Documentation
 *
 * Locale-aware date and relative time formatting via data attributes.
 */
import DocsLayout from '../../../layouts/DocsLayout.astro';

// Generate dynamic datetimes for demos
const now = new Date();
const fiveMinAgo = new Date(now.getTime() - 5 * 60 * 1000).toISOString();
const twoHoursAgo = new Date(now.getTime() - 2 * 60 * 60 * 1000).toISOString();
const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000).toISOString();
const lastWeek = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString();
const inOneHour = new Date(now.getTime() + 60 * 60 * 1000).toISOString();

const basicCode = `<time datetime="2026-02-09" data-format-date>Feb 9, 2026</time>`;

const stylesCode = `<!-- Medium (default) -->
<time datetime="2026-02-09" data-format-date>Feb 9, 2026</time>

<!-- Short -->
<time datetime="2026-02-09" data-format-date="short">2/9/26</time>

<!-- Long -->
<time datetime="2026-02-09" data-format-date="long">February 9, 2026</time>

<!-- Full -->
<time datetime="2026-02-09" data-format-date="full">Sunday, February 9, 2026</time>`;

const withTimeCode = `<time datetime="2026-02-09T14:30:00" data-format-date="long" data-format-time="short">
  February 9, 2026, 2:30 PM
</time>`;

const relativeCode = `<time datetime="2026-02-09T10:00:00Z" data-format-date="relative">February 9, 2026</time>`;

const activityCode = `<ul>
  <li>
    Alice commented
    <time datetime="..." data-format-date="relative">5 minutes ago</time>
  </li>
  <li>
    Bob pushed a commit
    <time datetime="..." data-format-date="relative">2 hours ago</time>
  </li>
</ul>`;

const localeCode = `<time datetime="2026-02-09" data-format-date="long" data-locale="de-DE">9. Februar 2026</time>
<time datetime="2026-02-09" data-format-date="long" data-locale="ja-JP">2026\u5E742\u67089\u65E5</time>`;

const dynamicCode = `// Dynamically added elements are auto-enhanced via MutationObserver
const time = document.createElement('time');
time.setAttribute('datetime', new Date().toISOString());
time.dataset.formatDate = 'relative';
time.textContent = 'just now';
document.body.appendChild(time);
// time is enhanced automatically \u2014 no manual init needed`;
---

<DocsLayout
  title="data-format-date"
  description="Locale-aware date and relative time formatting using Intl.DateTimeFormat and Intl.RelativeTimeFormat. Add data-format-date to any <time> element."
  currentSection="api"
>
  <h1>data-format-date</h1>
  <p class="lead">Locale-aware date and relative time formatting. Add <code>data-format-date</code> to any <code>&lt;time&gt;</code> element for automatic formatting via <code>Intl.DateTimeFormat</code> or <code>Intl.RelativeTimeFormat</code>.</p>

  <heading-links data-levels="h2,h3">
  <section>
    <h2>Overview</h2>
    <p>The <code>data-format-date</code> attribute enhances native <code>&lt;time&gt;</code> elements by replacing their text content with a locale-aware formatted date. Supports both absolute date formats and auto-refreshing relative time strings.</p>

    <browser-window
      src="/docs/examples/demos/format-date-basic.html"
      url="https://vanilla-breeze.dev/format-date"
      title="Format Date"
      shadow>
    </browser-window>

    <code-block language="html" show-lines label="Basic usage">{basicCode}</code-block>
  </section>

  <section>
    <h2>How It Works</h2>
    <ol>
      <li>Reads the <code>datetime</code> attribute from the <code>&lt;time&gt;</code> element</li>
      <li>Stores the original text content as a <code>title</code> attribute (visible on hover)</li>
      <li>For absolute styles: formats using <code>Intl.DateTimeFormat</code> with the specified <code>dateStyle</code></li>
      <li>For <code>"relative"</code>: formats using <code>Intl.RelativeTimeFormat</code> and starts adaptive auto-refresh</li>
    </ol>
    <p>The formatting uses the user's browser locale by default.</p>
  </section>

  <section>
    <h2>Attributes</h2>
    <table class="props-table">
      <thead>
        <tr>
          <th>Attribute</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>data-format-date</code></td>
          <td>string</td>
          <td>Date style: <code>""</code> / <code>"medium"</code> (default), <code>"short"</code>, <code>"long"</code>, <code>"full"</code>, <code>"relative"</code>.</td>
        </tr>
        <tr>
          <td><code>datetime</code></td>
          <td>string</td>
          <td>Standard HTML <code>datetime</code> attribute. Must be a valid date string (ISO 8601 recommended).</td>
        </tr>
        <tr>
          <td><code>data-format-time</code></td>
          <td>string</td>
          <td>Optional time style: <code>"short"</code>, <code>"medium"</code>, <code>"long"</code>, <code>"full"</code>. Ignored when <code>"relative"</code>.</td>
        </tr>
        <tr>
          <td><code>data-locale</code></td>
          <td>string</td>
          <td>Optional locale override (e.g., <code>"de-DE"</code>). Defaults to browser locale.</td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td>string</td>
          <td>Set automatically to the original text content (unless already set). Provides hover tooltip.</td>
        </tr>
        <tr>
          <td><code>data-format-date-init</code></td>
          <td>boolean</td>
          <td>Set automatically to prevent double-binding. Do not set manually.</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>Absolute Date Styles</h2>
    <p>Date styles map directly to <code>Intl.DateTimeFormat</code>'s <code>dateStyle</code> option:</p>

    <div class="example">
      <layout-stack data-layout-gap="s">
        <p>Default (medium): <time datetime="2026-02-09" data-format-date>Feb 9, 2026</time></p>
        <p>Short: <time datetime="2026-02-09" data-format-date="short">2/9/26</time></p>
        <p>Long: <time datetime="2026-02-09" data-format-date="long">February 9, 2026</time></p>
        <p>Full: <time datetime="2026-02-09" data-format-date="full">Sunday, February 9, 2026</time></p>
      </layout-stack>
    </div>

    <code-block language="html" show-lines label="Date style options">{stylesCode}</code-block>

    <h3>With Time</h3>
    <p>Add <code>data-format-time</code> to include the time component:</p>

    <div class="example">
      <time datetime="2026-02-09T14:30:00" data-format-date="long" data-format-time="short">February 9, 2026, 2:30 PM</time>
    </div>

    <code-block language="html" show-lines label="Date with time">{withTimeCode}</code-block>
  </section>

  <section>
    <h2>Relative Time</h2>
    <p>Use <code>data-format-date="relative"</code> for auto-refreshing relative time strings like "3 hours ago" or "in 2 days".</p>

    <div class="example">
      <layout-stack data-layout-gap="s">
        <p>5 minutes ago: <time datetime={fiveMinAgo} data-format-date="relative">Loading...</time></p>
        <p>2 hours ago: <time datetime={twoHoursAgo} data-format-date="relative">Loading...</time></p>
        <p>Yesterday: <time datetime={yesterday} data-format-date="relative">Loading...</time></p>
        <p>Last week: <time datetime={lastWeek} data-format-date="relative">Loading...</time></p>
        <p>In 1 hour: <time datetime={inOneHour} data-format-date="relative">Loading...</time></p>
      </layout-stack>
    </div>

    <code-block language="html" show-lines label="Relative time">{relativeCode}</code-block>

    <h3>Auto-Refresh Intervals</h3>
    <p>Relative times update automatically on an adaptive schedule:</p>

    <table class="props-table">
      <thead>
        <tr>
          <th>Age of timestamp</th>
          <th>Refresh interval</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>&lt; 1 hour</td>
          <td>Every 60 seconds</td>
        </tr>
        <tr>
          <td>&lt; 24 hours</td>
          <td>Every 5 minutes</td>
        </tr>
        <tr>
          <td>&gt; 24 hours</td>
          <td>Every hour</td>
        </tr>
      </tbody>
    </table>

    <p>Intervals are automatically cleared when elements are removed from the DOM (tracked via MutationObserver).</p>
  </section>

  <section>
    <h2>Locale Override</h2>
    <p>Use <code>data-locale</code> to force a specific locale for formatting:</p>

    <div class="example">
      <layout-stack data-layout-gap="s">
        <p>German: <time datetime="2026-02-09" data-format-date="long" data-locale="de-DE">9. Februar 2026</time></p>
        <p>Japanese: <time datetime="2026-02-09" data-format-date="long" data-locale="ja-JP">2026&#24180;2&#26376;9&#26085;</time></p>
      </layout-stack>
    </div>

    <code-block language="html" show-lines label="Locale override">{localeCode}</code-block>
  </section>

  <section>
    <h2>Common Use Cases</h2>

    <h3>Activity Feeds</h3>
    <p>Show when events happened in a list:</p>

    <div class="example">
      <layout-stack data-layout-gap="s">
        <p>Alice commented <time datetime={fiveMinAgo} data-format-date="relative">just now</time></p>
        <p>Bob pushed a commit <time datetime={twoHoursAgo} data-format-date="relative">earlier today</time></p>
        <p>Carol opened an issue <time datetime={lastWeek} data-format-date="relative">last week</time></p>
      </layout-stack>
    </div>

    <code-block language="html" show-lines label="Activity feed timestamps">{activityCode}</code-block>

    <h3>Content Metadata</h3>
    <p>Display article or post timestamps:</p>

    <div class="example">
      <article>
        <h3 style="margin: 0;">Getting Started with Vanilla Breeze</h3>
        <p style="color: var(--color-text-muted); margin-block-start: var(--size-xs);">
          Published <time datetime={yesterday} data-format-date="relative">yesterday</time>
        </p>
      </article>
    </div>
  </section>

  <section>
    <h2>Dynamic Elements</h2>
    <p>Elements added to the DOM after page load are automatically enhanced via a MutationObserver. No manual initialization is needed.</p>

    <code-block language="javascript" show-lines label="Dynamically added format-date elements">{dynamicCode}</code-block>
  </section>

  <section>
    <h2>Progressive Enhancement</h2>
    <p>The <code>&lt;time&gt;</code> element's original text serves as a fallback when JavaScript is unavailable. Users always see a readable date, with formatting layered on top.</p>

    <code-block language="html" show-lines label="Fallback text visible without JS">{basicCode}</code-block>
  </section>

  <section>
    <h2>Accessibility</h2>
    <ul>
      <li>The original human-readable date is preserved as a <code>title</code> attribute, accessible on hover</li>
      <li>For relative times, the <code>cursor: help</code> style hints that additional information is available</li>
      <li>The semantic <code>&lt;time&gt;</code> element with <code>datetime</code> attribute provides machine-readable dates for assistive technology</li>
      <li>Falls back to the original text content when JavaScript is unavailable</li>
      <li>No wrapper element &mdash; the <code>&lt;time&gt;</code> <em>is</em> the enhanced element, keeping the accessibility tree clean</li>
    </ul>
  </section>

  </heading-links>
</DocsLayout>
