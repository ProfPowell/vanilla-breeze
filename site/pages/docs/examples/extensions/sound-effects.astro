---
/**
 * Sound Effects Demo
 *
 * Experimental audio feedback using Web Audio API.
 * Click, hover, success, and error sounds with user preference controls.
 */

import DocsLayout from '../../../../layouts/DocsLayout.astro';

// Code examples
const soundCode = `// Web Audio API tone generator
function playTone(frequency, duration, type = 'sine') {
  const ctx = new AudioContext();
  const oscillator = ctx.createOscillator();
  const gainNode = ctx.createGain();

  oscillator.connect(gainNode);
  gainNode.connect(ctx.destination);

  oscillator.frequency.value = frequency;
  oscillator.type = type;
  gainNode.gain.value = volume * 0.3;

  oscillator.start();
  gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
  oscillator.stop(ctx.currentTime + duration);
}`;
---

<DocsLayout
  title="Sound Effects"
  description="Experimental audio feedback using Web Audio API with user preference controls."
  currentSection="examples"
>
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <ol>
      <li><a href="/docs/examples/">Examples</a></li>
      <li><a href="/docs/examples/extensions/">Extensions</a></li>
      <li><span aria-current="page">Sound Effects</span></li>
    </ol>
  </nav>

  <h1>Sound Effects</h1>
  <p class="lead">Experimental audio feedback using Web Audio API. Click, hover, success, and error sounds with user preference controls.</p>

  <div class="callout callout--info" style="margin-block-end: var(--size-l);">
    <strong>Token Reference:</strong> See <a href="/docs/themes/#extensions">Themes &gt; Extensions</a> for token documentation.
    Source: <code>src/lib/sound-manager.js</code>
  </div>

  <div class="sound-controls">
    <button id="sound-toggle" class="sound-toggle-btn" aria-pressed="false">
      <span class="sound-icon">üîä</span>
      <span class="sound-label">Enable Sound</span>
    </button>
    <label class="volume-control">
      Volume:
      <input type="range" id="volume" min="0" max="100" value="50" />
    </label>
  </div>

  <section>
    <h2>Interaction Sounds</h2>
    <p>Click the buttons to hear different sound effects.</p>
    <browser-window url="interaction-sounds">
      <div class="sound-grid">
        <button class="sound-btn" data-sound="click">
          <span class="sound-icon">üëÜ</span>
          <span>Click</span>
        </button>
        <button class="sound-btn" data-sound="success">
          <span class="sound-icon">‚úÖ</span>
          <span>Success</span>
        </button>
        <button class="sound-btn" data-sound="error">
          <span class="sound-icon">‚ùå</span>
          <span>Error</span>
        </button>
        <button class="sound-btn" data-sound="notification">
          <span class="sound-icon">üîî</span>
          <span>Notification</span>
        </button>
      </div>
    </browser-window>
    <code-block language="javascript" label="Web Audio API tone generator">{soundCode}</code-block>
  </section>

  <section>
    <h2>Hover Sounds</h2>
    <p>Hover over cards to trigger subtle audio feedback.</p>
    <browser-window url="hover-sounds">
      <div class="hover-grid">
        <div class="hover-card" data-hover-sound="soft">
          <h3>Soft</h3>
          <p>Subtle pop</p>
        </div>
        <div class="hover-card" data-hover-sound="tick">
          <h3>Tick</h3>
          <p>Clock tick</p>
        </div>
        <div class="hover-card" data-hover-sound="whoosh">
          <h3>Whoosh</h3>
          <p>Air sound</p>
        </div>
      </div>
    </browser-window>
  </section>

  <section>
    <h2>Considerations</h2>
    <p>Important factors for implementing sound in web interfaces.</p>
    <ul>
      <li><strong>Opt-in by default:</strong> Sound should be disabled until the user explicitly enables it.</li>
      <li><strong>Volume control:</strong> Users should be able to adjust or mute sounds independently.</li>
      <li><strong>Accessibility:</strong> Never rely on sound alone to convey information. Always pair with visual feedback.</li>
      <li><strong>Performance:</strong> Use Web Audio API with pre-generated oscillator tones instead of audio files.</li>
      <li><strong>Context:</strong> Consider if sound adds value or is just noise. Most web apps don't need sound.</li>
    </ul>
  </section>
</DocsLayout>

<style>
  .sound-controls {
    display: flex;
    gap: var(--size-m);
    align-items: center;
    padding: var(--size-m);
    background: var(--color-surface-alt);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-m);
    margin-block-end: var(--size-l);
  }

  .sound-toggle-btn {
    display: flex;
    align-items: center;
    gap: var(--size-xs);
    padding: var(--size-s) var(--size-m);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-s);
    cursor: pointer;
    font-family: inherit;
    font-size: var(--font-size-sm);
    color: var(--color-text);
    transition: background 0.15s ease, border-color 0.15s ease;
  }

  .sound-toggle-btn:hover {
    background: var(--color-surface-alt);
    border-color: var(--color-border-strong, var(--color-border));
  }

  .sound-toggle-btn[aria-pressed="true"] {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }

  .volume-control {
    display: flex;
    align-items: center;
    gap: var(--size-xs);
    font-size: var(--font-size-sm);
  }

  .volume-control input {
    width: 100px;
  }

  .sound-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: var(--size-m);
    padding: var(--size-m);
  }

  .sound-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--size-xs);
    padding: var(--size-l);
    background: var(--color-surface-alt);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-m);
    cursor: pointer;
    font-family: inherit;
    color: var(--color-text);
    transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
  }

  .sound-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border-color: var(--color-border-strong, var(--color-border));
  }

  .sound-btn:active {
    transform: translateY(0);
  }

  .sound-btn .sound-icon {
    font-size: 2rem;
  }

  .hover-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--size-m);
    padding: var(--size-m);
  }

  .hover-card {
    padding: var(--size-l);
    background: var(--color-surface-alt);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-m);
    text-align: center;
    color: var(--color-text);
    transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
  }

  .hover-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border-color: var(--color-border-strong, var(--color-border));
  }

  .hover-card h3 {
    margin: 0 0 var(--size-xs) 0;
    color: var(--color-text);
  }

  .hover-card p {
    margin: 0;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }
</style>

<script>
  // Web Audio API Sound Effects
  let audioContext: AudioContext | null = null;
  let soundEnabled = false;
  let volume = 0.5;

  function initAudio() {
    if (!audioContext) {
      audioContext = new AudioContext();
    }
    return audioContext;
  }

  function playTone(frequency: number, duration: number, type: OscillatorType = 'sine') {
    if (!soundEnabled) return;
    const ctx = initAudio();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);

    oscillator.frequency.value = frequency;
    oscillator.type = type;
    gainNode.gain.value = volume * 0.3;

    oscillator.start();
    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
    oscillator.stop(ctx.currentTime + duration);
  }

  const sounds = {
    click: () => playTone(800, 0.1),
    success: () => {
      playTone(523, 0.1);
      setTimeout(() => playTone(659, 0.1), 100);
      setTimeout(() => playTone(784, 0.15), 200);
    },
    error: () => {
      playTone(200, 0.15, 'sawtooth');
      setTimeout(() => playTone(180, 0.2, 'sawtooth'), 150);
    },
    notification: () => {
      playTone(880, 0.1);
      setTimeout(() => playTone(1100, 0.15), 100);
    },
    soft: () => playTone(600, 0.05),
    tick: () => playTone(1200, 0.02, 'square'),
    whoosh: () => {
      if (!soundEnabled || !audioContext) return;
      const ctx = initAudio();
      const noise = ctx.createOscillator();
      const filter = ctx.createBiquadFilter();
      const gain = ctx.createGain();

      noise.type = 'sawtooth';
      noise.frequency.value = 100;
      filter.type = 'lowpass';
      filter.frequency.value = 1000;

      noise.connect(filter);
      filter.connect(gain);
      gain.connect(ctx.destination);

      gain.gain.value = volume * 0.2;
      noise.start();
      filter.frequency.exponentialRampToValueAtTime(4000, ctx.currentTime + 0.1);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
      noise.stop(ctx.currentTime + 0.15);
    }
  };

  // Toggle sound
  const toggleBtn = document.getElementById('sound-toggle');
  toggleBtn?.addEventListener('click', () => {
    soundEnabled = !soundEnabled;
    toggleBtn.setAttribute('aria-pressed', String(soundEnabled));
    const label = toggleBtn.querySelector('.sound-label');
    if (label) label.textContent = soundEnabled ? 'Sound On' : 'Enable Sound';
    if (soundEnabled) {
      initAudio();
      sounds.click();
    }
  });

  // Volume control
  const volumeInput = document.getElementById('volume') as HTMLInputElement;
  volumeInput?.addEventListener('input', () => {
    volume = parseInt(volumeInput.value) / 100;
  });

  // Sound buttons
  document.querySelectorAll('[data-sound]').forEach(btn => {
    btn.addEventListener('click', () => {
      const soundName = (btn as HTMLElement).dataset.sound as keyof typeof sounds;
      if (sounds[soundName]) sounds[soundName]();
    });
  });

  // Hover sounds
  document.querySelectorAll('[data-hover-sound]').forEach(card => {
    card.addEventListener('mouseenter', () => {
      const soundName = (card as HTMLElement).dataset.hoverSound as keyof typeof sounds;
      if (sounds[soundName]) sounds[soundName]();
    });
  });
</script>
