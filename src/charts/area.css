/**
 * Area Chart - Charts.css Pattern
 *
 * Uses clip-path polygon to create filled area under the line.
 * Polygon extends from line down to baseline (100%).
 * Each td needs --start and --end CSS variables (0-1 range).
 *
 * Usage:
 * <table class="vb-chart" data-type="area">
 *   <caption>Chart Title</caption>
 *   <tbody>
 *     <tr>
 *       <th scope="row">Jan</th>
 *       <td style="--start: 0; --end: 0.30">3k</td>
 *     </tr>
 *     <tr>
 *       <th scope="row">Feb</th>
 *       <td style="--start: 0.30; --end: 0.45">4.5k</td>
 *     </tr>
 *   </tbody>
 * </table>
 *
 * Key pattern: --start = previous row's --end value
 */

.vb-chart[data-type="area"] {
  --dot-size: 8px;
}

.vb-chart[data-type="area"] tbody {
  display: flex;
  height: var(--chart-height, 200px);
  border-block-end: 1px solid var(--chart-axis-color);
  border-inline-start: 1px solid var(--chart-axis-color);
  position: relative;
}

.vb-chart[data-type="area"] tr {
  flex: 1;
  position: relative;
  height: 100%;
}

/* X-axis labels below chart */
.vb-chart[data-type="area"] th {
  position: absolute;
  inset-block-end: -1.5em;
  inset-inline-start: 50%;
  transform: translateX(-50%);
  font-size: var(--font-size-xs, 0.75rem);
  color: var(--chart-label-color);
  white-space: nowrap;
}

/* The filled area segment using clip-path polygon */
.vb-chart[data-type="area"] td {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to top,
    color-mix(in srgb, var(--chart-series-1) 40%, transparent),
    color-mix(in srgb, var(--chart-series-1) 20%, transparent)
  );

  /* Clip polygon: line at top, extends to baseline */
  clip-path: polygon(
    0% calc(100% * (1 - var(--start, 0))),  /* start point */
    100% calc(100% * (1 - var(--end, 0))),  /* end point */
    100% 100%,                               /* bottom-right */
    0% 100%                                  /* bottom-left */
  );

  /* Hide text */
  font-size: 0;
  color: transparent;

  transition: opacity var(--chart-duration, 300ms) var(--chart-easing, ease);
}

/* Line on top of area */
.vb-chart[data-type="area"] td::before {
  content: "";
  position: absolute;
  inset: 0;
  background: var(--chart-series-1);
  clip-path: polygon(
    0% calc(100% * (1 - var(--start, 0))),
    100% calc(100% * (1 - var(--end, 0))),
    100% calc(100% * (1 - var(--end, 0)) + 2px),
    0% calc(100% * (1 - var(--start, 0)) + 2px)
  );
}

/* Data point dot at the end position */
.vb-chart[data-type="area"] td::after {
  content: "";
  position: absolute;
  inset-block-end: calc(var(--end, 0) * 100% - var(--dot-size) / 2);
  inset-inline-end: calc(var(--dot-size) / -2);
  width: var(--dot-size);
  height: var(--dot-size);
  background: var(--chart-series-1);
  border-radius: 50%;
  border: 2px solid var(--color-surface, #fff);
  z-index: 2;
  transition: transform var(--chart-duration, 300ms) var(--chart-easing, ease);
}

/* Hover effect */
.vb-chart[data-type="area"] td:hover {
  background: linear-gradient(
    to top,
    color-mix(in srgb, var(--chart-series-1) 50%, transparent),
    color-mix(in srgb, var(--chart-series-1) 30%, transparent)
  );
}

.vb-chart[data-type="area"] td:hover::after {
  transform: scale(1.3);
}

/* Series colors */
.vb-chart[data-type="area"] td[data-series="2"] {
  background: linear-gradient(
    to top,
    color-mix(in srgb, var(--chart-series-2) 40%, transparent),
    color-mix(in srgb, var(--chart-series-2) 20%, transparent)
  );
}
.vb-chart[data-type="area"] td[data-series="2"]::before { background: var(--chart-series-2); }
.vb-chart[data-type="area"] td[data-series="2"]::after { background: var(--chart-series-2); }

.vb-chart[data-type="area"] td[data-series="3"] {
  background: linear-gradient(
    to top,
    color-mix(in srgb, var(--chart-series-3) 40%, transparent),
    color-mix(in srgb, var(--chart-series-3) 20%, transparent)
  );
}
.vb-chart[data-type="area"] td[data-series="3"]::before { background: var(--chart-series-3); }
.vb-chart[data-type="area"] td[data-series="3"]::after { background: var(--chart-series-3); }

.vb-chart[data-type="area"] td[data-series="4"] {
  background: linear-gradient(
    to top,
    color-mix(in srgb, var(--chart-series-4) 40%, transparent),
    color-mix(in srgb, var(--chart-series-4) 20%, transparent)
  );
}
.vb-chart[data-type="area"] td[data-series="4"]::before { background: var(--chart-series-4); }
.vb-chart[data-type="area"] td[data-series="4"]::after { background: var(--chart-series-4); }

/* First element shows starting dot at left edge */
.vb-chart[data-type="area"] tr:first-child td::after {
  /* Move to left edge at start position for first element */
}

/* Grid lines */
.vb-chart[data-type="area"][data-grid] tbody {
  background-image: repeating-linear-gradient(
    to top,
    var(--chart-grid-color) 0,
    var(--chart-grid-color) 1px,
    transparent 1px,
    transparent 25%
  );
}

/* Show value labels */
.vb-chart[data-type="area"][data-labels] td::after {
  content: attr(data-label);
}
