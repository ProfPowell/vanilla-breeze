/* tooltip: Native tooltip using Popover API + CSS Anchor Positioning */

/*
 * Usage:
 * <button aria-describedby="tip1">Hover me</button>
 * <div id="tip1" popover="hint" role="tooltip">Tooltip content</div>
 *
 * For click-triggered (no JS needed):
 * <button popovertarget="tip2">Click me</button>
 * <div id="tip2" popover="auto" role="tooltip">Click tooltip</div>
 */

[role="tooltip"][popover] {
  /* Reset popover defaults */
  border: none;
  padding: 0;
  margin: 0;
  background: transparent;
  overflow: visible;

  /* Tooltip styling */
  background: var(--color-gray-900);
  color: var(--color-gray-50);
  padding: var(--size-xs) var(--size-s);
  font-size: var(--font-size-sm);
  line-height: var(--line-height-normal);
  border-radius: var(--radius-s);
  max-inline-size: 20rem;
  white-space: normal;
  word-wrap: break-word;

  /* Animation - exit state */
  opacity: 0;
  transform: translateY(4px);

  transition:
    opacity var(--duration-fast) var(--ease-default),
    transform var(--duration-fast) var(--ease-default),
    display var(--duration-fast) allow-discrete,
    overlay var(--duration-fast) allow-discrete;
}

[role="tooltip"][popover]:popover-open {
  opacity: 1;
  transform: translateY(0);
}

/* Entry animation starting point */
@starting-style {
  [role="tooltip"][popover]:popover-open {
    opacity: 0;
    transform: translateY(4px);
  }
}

/* --- Positioning --- */

[role="tooltip"][popover] {
  position: fixed;
  /* JS sets top/left, or CSS anchor positioning takes over */
}

/* Anchor-positioned tooltips (init-created, outside tooltip-wc) */
[role="tooltip"][popover][data-anchor] {
  inset: auto;
}

[role="tooltip"][popover][data-anchor]:not([data-tooltip-position]),
[role="tooltip"][popover][data-anchor][data-tooltip-position="top"] {
  bottom: anchor(top);
  left: anchor(center);
  translate: -50% calc(-1 * var(--size-xs));
}

[role="tooltip"][popover][data-anchor][data-tooltip-position="bottom"] {
  top: anchor(bottom);
  left: anchor(center);
  translate: -50% var(--size-xs);
}

[role="tooltip"][popover][data-anchor][data-tooltip-position="left"] {
  right: anchor(left);
  top: anchor(center);
  translate: calc(-1 * var(--size-xs)) -50%;
}

[role="tooltip"][popover][data-anchor][data-tooltip-position="right"] {
  left: anchor(right);
  top: anchor(center);
  translate: var(--size-xs) -50%;
}

/* --- Arrow (optional) --- */

[role="tooltip"][popover] > .tooltip-arrow {
  position: absolute;
  inline-size: 8px;
  block-size: 8px;
  background: inherit;
  transform: rotate(45deg);
  pointer-events: none;
}

/* Arrow positions */
[role="tooltip"][popover]:not([data-tooltip-position]),
[role="tooltip"][popover][data-tooltip-position="top"] {
  & > .tooltip-arrow {
    inset-block-end: -4px;
    inset-inline-start: calc(50% - 4px);
  }
}

[role="tooltip"][popover][data-tooltip-position="bottom"] > .tooltip-arrow {
  inset-block-start: -4px;
  inset-inline-start: calc(50% - 4px);
}

[role="tooltip"][popover][data-tooltip-position="left"] > .tooltip-arrow {
  inset-inline-end: -4px;
  inset-block-start: calc(50% - 4px);
}

[role="tooltip"][popover][data-tooltip-position="right"] > .tooltip-arrow {
  inset-inline-start: -4px;
  inset-block-start: calc(50% - 4px);
}

/* --- Content inside tooltips --- */

[role="tooltip"][popover] {
  /* kbd styling for dark tooltip background */
  & kbd {
    background: oklch(100% 0 0 / 0.15);
    border-color: oklch(100% 0 0 / 0.3);
    box-shadow: 0 1px 0 oklch(100% 0 0 / 0.2);
    color: inherit;
  }

  /* small text */
  & small {
    opacity: 0.8;
  }

  /* code styling */
  & code {
    background: oklch(100% 0 0 / 0.15);
    color: inherit;
  }
}

/* --- Dark Mode --- */

@media (prefers-color-scheme: dark) {
  [role="tooltip"][popover] {
    background: var(--color-gray-100);
    color: var(--color-gray-900);

    /* kbd styling for light tooltip background */
    & kbd {
      background: oklch(0% 0 0 / 0.1);
      border-color: oklch(0% 0 0 / 0.2);
      box-shadow: 0 1px 0 oklch(0% 0 0 / 0.15);
    }

    /* code styling */
    & code {
      background: oklch(0% 0 0 / 0.1);
    }
  }
}

/* ---- interestfor-driven tooltips ---- */

[popover="hint"]:not([role="tooltip"]) {
  border: none;
  padding: 0;
  margin: 0;
  overflow: visible;

  background: var(--color-gray-900);
  color: var(--color-gray-50);
  padding: var(--size-xs) var(--size-s);
  font-size: var(--font-size-sm);
  border-radius: var(--radius-s);
  max-inline-size: 20rem;
  white-space: normal;
  word-wrap: break-word;

  /* Positioning â€” fixed for JS fallback, anchor for native path */
  position: fixed;
  inset: unset;
  position-area: block-start;
  margin-block-end: 8px;
  position-try-fallbacks: flip-block;

  /* Polyfill timing */
  --interest-delay-start: 200ms;
  --interest-delay-end: 100ms;

  /* Animation */
  opacity: 0;
  transform: translateY(4px);
  transition:
    opacity var(--duration-fast) var(--ease-default),
    transform var(--duration-fast) var(--ease-default),
    display var(--duration-fast) allow-discrete,
    overlay var(--duration-fast) allow-discrete;
}

[popover="hint"]:not([role="tooltip"]):popover-open {
  opacity: 1;
  transform: translateY(0);
}

@starting-style {
  [popover="hint"]:not([role="tooltip"]):popover-open {
    opacity: 0;
    transform: translateY(4px);
  }
}

@media (prefers-color-scheme: dark) {
  [popover="hint"]:not([role="tooltip"]) {
    background: var(--color-gray-100);
    color: var(--color-gray-900);
  }
}

/* --- Reduced Motion --- */

@media (prefers-reduced-motion: reduce) {
  [role="tooltip"][popover] {
    transition: none;
  }

  [popover="hint"]:not([role="tooltip"]) {
    transition: none;
  }
}
