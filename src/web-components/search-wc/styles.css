/* search-wc: Site search component */

search-wc {
  display: inline-block;
  position: relative;

  /* Dialog open state */
  &[data-open] .dialog {
    display: block;
  }
}

@scope (search-wc) {
  /* --- Dialog (hidden by default) --- */
  .dialog {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 9999;
  }

  /* --- Backdrop --- */
  .backdrop {
    position: absolute;
    inset: 0;
    background: oklch(0% 0 0 / 0.5);
    animation: vb-fade-in var(--motion-enter-duration) var(--ease-out);
  }

  /* --- Panel --- */
  .panel {
    position: absolute;
    inset-block-start: 10vh;
    inset-inline: 50%;
    transform: translateX(-50%);
    inline-size: min(90vw, 600px);
    max-block-size: 70vh;
    display: flex;
    flex-direction: column;
    background: var(--color-surface);
    border: var(--border-width-thin) solid var(--color-border);
    border-radius: var(--radius-l);
    box-shadow: var(--shadow-xl);
    overflow: hidden;
    animation: slide-in var(--motion-enter-duration) var(--ease-out);
  }

  /* --- Input Wrapper --- */
  .input-wrapper {
    display: flex;
    align-items: center;
    gap: var(--size-s);
    padding: var(--size-m) var(--size-l);
    border-block-end: var(--border-width-thin) solid var(--color-border);
  }

  .icon {
    flex-shrink: 0;
    color: var(--color-text-muted);
  }

  .input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: var(--font-size-lg);
    color: var(--color-text);
    outline: none;

    &::placeholder {
      color: var(--color-text-muted);
    }

    /* Hide the clear button in WebKit */
    &::-webkit-search-cancel-button {
      display: none;
    }
  }

  .shortcut {
    flex-shrink: 0;
    padding: var(--size-3xs) var(--size-xs);
    background: var(--color-surface-raised);
    border: var(--border-width-thin) solid var(--color-border);
    border-radius: var(--radius-s);
    font-size: var(--font-size-xs);
    font-family: var(--font-mono);
    color: var(--color-text-muted);
  }

  /* --- Results --- */
  .results {
    flex: 1;
    overflow-y: auto;
    padding: var(--size-xs);
  }

  .result {
    display: block;
    padding: var(--size-s) var(--size-m);
    border-radius: var(--radius-s);
    text-decoration: none;
    color: inherit;
    cursor: pointer;

    &:hover,
    &[data-active] {
      background: var(--color-surface-raised);
    }

    &[data-active] {
      outline: 2px solid var(--color-interactive);
      outline-offset: -2px;
    }
  }

  .result-title {
    display: block;
    font-weight: 600;
    color: var(--color-text);
    margin-block-end: var(--size-3xs);
  }

  .result-excerpt {
    display: block;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    line-height: 1.4;

    /* Highlight matched terms */
    & mark {
      background: oklch(from var(--color-warning) l c h / 0.3);
      color: inherit;
      border-radius: 2px;
      padding-inline: 1px;
    }
  }

  /* --- States --- */
  .loading,
  .empty,
  .error {
    padding: var(--size-xl);
    text-align: center;
    color: var(--color-text-muted);
  }

  .error {
    color: var(--color-error);

    & code {
      display: inline-block;
      margin-block-start: var(--size-xs);
      padding: var(--size-2xs) var(--size-xs);
      background: var(--color-surface-raised);
      border-radius: var(--radius-s);
      font-size: var(--font-size-sm);
      color: var(--color-text);
    }
  }

  /* --- Footer --- */
  .footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--size-m);
    padding: var(--size-s) var(--size-l);
    border-block-start: var(--border-width-thin) solid var(--color-border);
    background: var(--color-surface-raised);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .hint {
    display: flex;
    gap: var(--size-xs);

    & kbd {
      padding: var(--size-3xs) var(--size-2xs);
      background: var(--color-surface);
      border: var(--border-width-thin) solid var(--color-border);
      border-radius: var(--radius-s);
      font-family: var(--font-mono);
      font-size: inherit;
    }
  }

  .powered {
    & a {
      color: inherit;
      text-decoration: underline;
      text-underline-offset: 2px;

      &:hover {
        color: var(--color-text);
      }
    }
  }
}

/* --- Keyframes --- */
@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-1rem);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* --- Reduced Motion --- */
@media (prefers-reduced-motion: reduce) {
  @scope (search-wc) {
    .backdrop,
    .panel {
      animation: none;
    }
  }
}

/* --- Mobile adjustments --- */
@media (max-width: 600px) {
  @scope (search-wc) {
    .panel {
      inset-block-start: 0;
      inset-inline: 0;
      transform: none;
      inline-size: 100%;
      max-block-size: 100vh;
      border-radius: 0;
      animation: vb-slide-down var(--motion-enter-duration) var(--ease-out);
    }

    .footer {
      flex-direction: column;
      gap: var(--size-xs);
    }
  }

}
