# Internationalization (i18n) Guide

## Language Detection Fallback Chain

Always implement this pattern:

```javascript
get lang() {
    return this.getAttribute('lang') ||                      // 1. Component attribute
           this.closest('[lang]')?.getAttribute('lang') ||   // 2. Nearest ancestor
           document.documentElement.lang ||                  // 3. Document root
           'en';                                             // 4. Default to English
}
```

## Translations Object Structure

Language codes as top-level keys:

```javascript
// my-component-i18n.js
export const translations = {
    en: {
        title: 'Settings',
        save: 'Save Changes',
        cancel: 'Cancel',
        errors: {
            required: 'This field is required',
            invalid: 'Please enter a valid value',
        },
    },
    es: {
        title: 'Configuracion',
        save: 'Guardar cambios',
        cancel: 'Cancelar',
        errors: {
            required: 'Este campo es obligatorio',
            invalid: 'Por favor ingrese un valor valido',
        },
    },
    ar: {
        title: 'الإعدادات',
        save: 'حفظ التغييرات',
        cancel: 'إلغاء',
        errors: {
            required: 'هذا الحقل مطلوب',
            invalid: 'الرجاء إدخال قيمة صالحة',
        },
    },
    ja: {
        title: '設定',
        save: '変更を保存',
        cancel: 'キャンセル',
        errors: {
            required: 'この項目は必須です',
            invalid: '有効な値を入力してください',
        },
    },
    zh: {
        title: '设置',
        save: '保存更改',
        cancel: '取消',
        errors: {
            required: '此字段为必填项',
            invalid: '请输入有效值',
        },
    },
    fr: {
        title: 'Parametres',
        save: 'Sauvegarder',
        cancel: 'Annuler',
        errors: {
            required: 'Ce champ est requis',
            invalid: 'Veuillez entrer une valeur valide',
        },
    },
    de: {
        title: 'Einstellungen',
        save: 'Speichern',
        cancel: 'Abbrechen',
        errors: {
            required: 'Dieses Feld ist erforderlich',
            invalid: 'Bitte geben Sie einen gultigen Wert ein',
        },
    },
};
```

## Translation Getter with Fallback

Always fall back to English:

```javascript
get translations() {
    return translations[this.lang] || translations.en;
}
```

## Language Change Observation

Watch for lang attribute changes:

```javascript
connectedCallback() {
    this.langObserver = new MutationObserver(() => this.render());

    // Watch document root
    this.langObserver.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['lang'],
    });

    // Watch ancestors with lang attribute
    let ancestor = this.parentElement;
    while (ancestor) {
        if (ancestor.hasAttribute('lang')) {
            this.langObserver.observe(ancestor, {
                attributes: true,
                attributeFilter: ['lang'],
            });
        }
        ancestor = ancestor.parentElement;
    }
}

disconnectedCallback() {
    this.langObserver?.disconnect();
}
```

## RTL Support

Handle right-to-left languages:

```javascript
const RTL_LANGUAGES = ['ar', 'he', 'fa', 'ur'];

handleLangChange(newLang) {
    const direction = RTL_LANGUAGES.includes(newLang) ? 'rtl' : 'ltr';
    document.documentElement.setAttribute('dir', direction);
}
```

In CSS:

```css
:host {
    direction: inherit;
}

/* RTL-specific adjustments */
:host(:dir(rtl)) .icon {
    transform: scaleX(-1);
}
```

## Template Usage

Pass translations to template function:

```javascript
render() {
    this.shadowRoot.innerHTML = `
        <style>${styles}</style>
        ${template(this.translations)}
    `;
}
```

## Pluralization Pattern

Handle singular/plural:

```javascript
const translations = {
    en: {
        itemCount: (count) => count === 1 ? '1 item' : `${count} items`,
        // Or with explicit forms
        items: {
            zero: 'No items',
            one: '1 item',
            other: '{count} items',
        },
    },
};

// Usage
const count = 5;
const text = typeof t.itemCount === 'function'
    ? t.itemCount(count)
    : t.items[count === 0 ? 'zero' : count === 1 ? 'one' : 'other'].replace('{count}', count);
```

## Date/Time Formatting

Use Intl API:

```javascript
formatDate(date) {
    return new Intl.DateTimeFormat(this.lang, {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
    }).format(date);
}

formatNumber(number) {
    return new Intl.NumberFormat(this.lang).format(number);
}

formatCurrency(amount, currency = 'USD') {
    return new Intl.NumberFormat(this.lang, {
        style: 'currency',
        currency,
    }).format(amount);
}
```

## Supported Languages Export

Export list for language pickers:

```javascript
export const supportedLanguages = {
    en: 'English',
    es: 'Espanol',
    ar: 'العربية',
    ja: '日本語',
    zh: '中文',
    fr: 'Francais',
    de: 'Deutsch',
};
```
