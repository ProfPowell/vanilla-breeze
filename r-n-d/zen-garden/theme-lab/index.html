<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Theme Lab - Combined R&amp;D | Vanilla Breeze</title>

  <!-- Google Fonts for font testing -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- Core VB System -->
  <link rel="stylesheet" href="/cdn/vanilla-breeze.css">

  <style>
    /* ============================================
       THEME LAB - COMBINED R&D ENVIRONMENT
       Comprehensive testing with all extensions
       ============================================ */

    :root {
      /* Motion tokens */
      --motion-hover-transform: translateY(-2px);
      --motion-stagger-delay: 50ms;
      --motion-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

      /* Surface tokens */
      --surface-texture: none;
      --surface-texture-opacity: 0.03;
      --glass-blur: 8px;

      /* Border tokens */
      --border-style: solid;
      --border-roughness: 0;

      /* Font tokens */
      --font-display: var(--font-sans);
      --font-body-custom: var(--font-sans);
    }

    body {
      display: grid;
      grid-template-columns: 320px 1fr;
      min-height: 100dvh;
    }

    @media (width < 900px) {
      body {
        grid-template-columns: 1fr;
      }

      .lab-sidebar {
        display: none;
      }

      .lab-sidebar.open {
        display: block;
        position: fixed;
        inset: 0;
        z-index: 1000;
      }
    }

    /* ============================================
       SIDEBAR - CONTROLS
       ============================================ */
    .lab-sidebar {
      background: var(--color-surface-raised);
      border-inline-end: 1px solid var(--color-border);
      overflow-y: auto;
      height: 100vh;
      position: sticky;
      top: 0;
    }

    .sidebar-header {
      padding: var(--space-4);
      border-bottom: 1px solid var(--color-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sidebar-header h1 {
      font-size: var(--text-lg);
      margin: 0;
    }

    .sidebar-section {
      padding: var(--space-4);
      border-bottom: 1px solid var(--color-border);
    }

    .sidebar-section h2 {
      font-size: var(--text-sm);
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin: 0 0 var(--space-3) 0;
    }

    .control-group {
      margin-block-end: var(--space-3);
    }

    .control-group:last-child {
      margin-block-end: 0;
    }

    .control-group label {
      display: flex;
      justify-content: space-between;
      font-size: var(--text-sm);
      margin-block-end: var(--space-1);
    }

    .control-group label span {
      color: var(--color-text-muted);
      font-size: var(--text-xs);
    }

    .control-group input[type="range"],
    .control-group select {
      width: 100%;
      padding: var(--space-1);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-s);
      background: var(--color-surface);
      color: var(--color-text);
      font-family: inherit;
      font-size: var(--text-sm);
    }

    .control-group input[type="color"] {
      width: 100%;
      height: 32px;
      padding: 0;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-s);
      cursor: pointer;
    }

    /* Button row */
    .button-row {
      display: flex;
      gap: var(--space-2);
    }

    .button-row button {
      flex: 1;
      padding: var(--space-2);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-s);
      background: var(--color-surface);
      font-family: inherit;
      font-size: var(--text-xs);
      cursor: pointer;
    }

    .button-row button:hover {
      background: var(--color-surface-alt);
    }

    .button-row button.active {
      background: var(--color-primary);
      color: white;
      border-color: var(--color-primary);
    }

    /* Export button */
    .export-btn {
      width: 100%;
      padding: var(--space-3);
      background: var(--color-primary);
      color: white;
      border: none;
      border-radius: var(--radius-s);
      font-family: inherit;
      font-size: var(--text-sm);
      font-weight: var(--weight-semibold);
      cursor: pointer;
    }

    .export-btn:hover {
      opacity: 0.9;
    }

    /* ============================================
       MAIN - PREVIEW AREA
       ============================================ */
    .lab-main {
      padding: var(--space-6);
      overflow-y: auto;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-block-end: var(--space-6);
    }

    .preview-header h2 {
      margin: 0;
    }

    .mobile-toggle {
      display: none;
      padding: var(--space-2) var(--space-3);
      background: var(--color-surface-raised);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-s);
      font-family: inherit;
      cursor: pointer;
    }

    @media (width < 900px) {
      .mobile-toggle {
        display: block;
      }
    }

    /* Preview sections */
    .preview-section {
      margin-block-end: var(--space-8);
      padding: var(--space-6);
      background: var(--color-surface-raised);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-l);
    }

    .preview-section h3 {
      margin: 0 0 var(--space-4) 0;
      font-size: var(--text-lg);
    }

    /* Typography preview */
    .typography-preview {
      display: grid;
      gap: var(--space-4);
    }

    .type-sample {
      padding: var(--space-4);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-m);
    }

    .type-sample h4 {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      margin: 0 0 var(--space-2) 0;
      font-family: var(--font-display);
    }

    .type-sample p {
      margin: 0;
      font-family: var(--font-body-custom);
      line-height: 1.6;
    }

    .type-sample code {
      font-family: var(--font-mono);
    }

    /* Cards preview */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
    }

    .preview-card {
      padding: var(--space-5);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-m);
      transition: transform var(--duration-normal) var(--ease-out-3),
                  box-shadow var(--duration-normal) var(--ease-out-3);
    }

    .preview-card:hover {
      transform: var(--motion-hover-transform);
      box-shadow: var(--shadow-lg);
    }

    .preview-card h4 {
      margin: 0 0 var(--space-2) 0;
    }

    .preview-card p {
      margin: 0;
      color: var(--color-text-muted);
      font-size: var(--text-sm);
    }

    /* Buttons preview */
    .buttons-preview {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-3);
    }

    .preview-btn {
      padding: var(--space-3) var(--space-5);
      border: none;
      border-radius: var(--radius-s);
      font-family: inherit;
      font-size: var(--text-base);
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    .preview-btn:hover {
      transform: translateY(-1px);
    }

    .preview-btn.primary {
      background: var(--color-primary);
      color: white;
    }

    .preview-btn.secondary {
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
    }

    .preview-btn.outline {
      background: transparent;
      border: 2px solid var(--color-primary);
      color: var(--color-primary);
    }

    /* Form preview */
    .form-preview {
      max-width: 400px;
    }

    .form-group-preview {
      margin-block-end: var(--space-4);
    }

    .form-group-preview label {
      display: block;
      margin-block-end: var(--space-2);
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
    }

    .form-group-preview input,
    .form-group-preview select {
      width: 100%;
      padding: var(--space-3);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-s);
      font-family: inherit;
      font-size: var(--text-base);
      background: var(--color-surface);
    }

    /* Stagger animation demo */
    .stagger-demo {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-3);
    }

    .stagger-item {
      padding: var(--space-3) var(--space-4);
      background: var(--color-primary);
      color: white;
      border-radius: var(--radius-s);
      opacity: 0;
      animation: stagger-in 300ms ease-out forwards;
    }

    @keyframes stagger-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stagger-item:nth-child(1) { animation-delay: calc(var(--motion-stagger-delay) * 0); }
    .stagger-item:nth-child(2) { animation-delay: calc(var(--motion-stagger-delay) * 1); }
    .stagger-item:nth-child(3) { animation-delay: calc(var(--motion-stagger-delay) * 2); }
    .stagger-item:nth-child(4) { animation-delay: calc(var(--motion-stagger-delay) * 3); }
    .stagger-item:nth-child(5) { animation-delay: calc(var(--motion-stagger-delay) * 4); }
    .stagger-item:nth-child(6) { animation-delay: calc(var(--motion-stagger-delay) * 5); }

    /* Texture preview */
    .texture-preview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--space-4);
    }

    .texture-sample {
      padding: var(--space-4);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-m);
      text-align: center;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .texture-sample::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: var(--surface-texture-opacity);
      pointer-events: none;
    }

    .texture-sample.noise::before {
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    .texture-sample.dots::before {
      background: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='2' cy='2' r='1' fill='%23000' fill-opacity='0.3'/%3E%3C/svg%3E");
    }

    .texture-sample.lines::before {
      background: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 6L6 0' stroke='%23000' stroke-opacity='0.15' stroke-width='0.5'/%3E%3C/svg%3E");
    }

    /* Glass preview */
    .glass-preview {
      padding: var(--space-8);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      border-radius: var(--radius-m);
    }

    .glass-card {
      max-width: 300px;
      margin: 0 auto;
      padding: var(--space-5);
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-m);
      color: white;
    }

    .glass-card h4 {
      margin: 0 0 var(--space-2) 0;
    }

    .glass-card p {
      margin: 0;
      opacity: 0.9;
      font-size: var(--text-sm);
    }

    /* Export modal */
    .export-modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 2000;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      padding: var(--space-4);
    }

    .export-modal.open {
      display: flex;
    }

    .export-content {
      max-width: 600px;
      max-height: 80vh;
      width: 100%;
      background: var(--color-surface-raised);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-l);
      overflow: hidden;
    }

    .export-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-4);
      border-bottom: 1px solid var(--color-border);
    }

    .export-header h3 {
      margin: 0;
    }

    .export-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--color-text-muted);
    }

    .export-body {
      padding: var(--space-4);
      overflow-y: auto;
      max-height: 60vh;
    }

    .export-body pre {
      background: var(--color-surface-sunken);
      padding: var(--space-4);
      border-radius: var(--radius-m);
      overflow-x: auto;
      font-family: var(--font-mono);
      font-size: var(--text-sm);
      margin: 0;
    }

    .export-footer {
      padding: var(--space-4);
      border-top: 1px solid var(--color-border);
      display: flex;
      gap: var(--space-3);
      justify-content: flex-end;
    }

    .export-footer button {
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-s);
      font-family: inherit;
      cursor: pointer;
    }

    .copy-btn {
      background: var(--color-primary);
      color: white;
      border: none;
    }

    .close-btn {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
    }
  </style>
</head>

<body>
  <!-- SVG Filters for rough borders -->
  <svg style="position: absolute; width: 0; height: 0; overflow: hidden;">
    <defs>
      <filter id="rough-light" x="-5%" y="-5%" width="110%" height="110%">
        <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="2" result="noise"/>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" xChannelSelector="R" yChannelSelector="G"/>
      </filter>
    </defs>
  </svg>

  <!-- Sidebar Controls -->
  <aside class="lab-sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1>Theme Lab</h1>
      <button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.remove('open')">
        Close
      </button>
    </div>

    <!-- Theme Selection -->
    <div class="sidebar-section">
      <h2>Base Theme</h2>
      <div class="control-group">
        <label for="theme-select">Theme</label>
        <select id="theme-select">
          <option value="">Default</option>
          <option value="ocean">Ocean</option>
          <option value="forest">Forest</option>
          <option value="sunset">Sunset</option>
          <option value="swiss">Swiss</option>
          <option value="brutalist">Brutalist</option>
          <option value="cyber">Cyber</option>
          <option value="organic">Organic</option>
        </select>
      </div>
      <div class="control-group">
        <label for="mode-select">Color Mode</label>
        <div class="button-row">
          <button id="mode-auto" class="active" data-mode="auto">Auto</button>
          <button id="mode-light" data-mode="light">Light</button>
          <button id="mode-dark" data-mode="dark">Dark</button>
        </div>
      </div>
    </div>

    <!-- Typography -->
    <div class="sidebar-section">
      <h2>Typography</h2>
      <div class="control-group">
        <label for="display-font">Display Font</label>
        <select id="display-font">
          <option value="system">System (Default)</option>
          <option value="playfair">Playfair Display</option>
          <option value="inter">Inter Bold</option>
        </select>
      </div>
      <div class="control-group">
        <label for="body-font">Body Font</label>
        <select id="body-font">
          <option value="system">System (Default)</option>
          <option value="inter">Inter</option>
        </select>
      </div>
    </div>

    <!-- Colors -->
    <div class="sidebar-section">
      <h2>Colors</h2>
      <div class="control-group">
        <label for="hue-shift">Primary Hue <span id="hue-value">260</span></label>
        <input type="range" id="hue-shift" min="0" max="360" value="260">
      </div>
      <div class="control-group">
        <label for="saturation">Saturation <span id="sat-value">60%</span></label>
        <input type="range" id="saturation" min="0" max="100" value="60">
      </div>
    </div>

    <!-- Motion -->
    <div class="sidebar-section">
      <h2>Motion</h2>
      <div class="control-group">
        <label for="stagger-delay">Stagger Delay <span id="stagger-value">50ms</span></label>
        <input type="range" id="stagger-delay" min="0" max="200" value="50">
      </div>
      <div class="control-group">
        <label for="hover-lift">Hover Lift <span id="lift-value">2px</span></label>
        <input type="range" id="hover-lift" min="0" max="10" value="2">
      </div>
    </div>

    <!-- Surfaces -->
    <div class="sidebar-section">
      <h2>Surfaces</h2>
      <div class="control-group">
        <label for="texture-opacity">Texture Opacity <span id="texture-value">3%</span></label>
        <input type="range" id="texture-opacity" min="0" max="20" value="3">
      </div>
      <div class="control-group">
        <label for="glass-blur">Glass Blur <span id="blur-value">8px</span></label>
        <input type="range" id="glass-blur" min="0" max="24" value="8">
      </div>
    </div>

    <!-- Borders -->
    <div class="sidebar-section">
      <h2>Borders</h2>
      <div class="control-group">
        <label for="border-radius">Radius <span id="radius-value">0.5rem</span></label>
        <input type="range" id="border-radius" min="0" max="24" value="8">
      </div>
      <div class="control-group">
        <label for="border-rough">Roughness</label>
        <div class="button-row">
          <button id="rough-0" class="active" data-rough="0">None</button>
          <button id="rough-1" data-rough="1">Light</button>
        </div>
      </div>
    </div>

    <!-- Export -->
    <div class="sidebar-section">
      <button class="export-btn" id="export-btn">Export Theme CSS</button>
    </div>
  </aside>

  <!-- Main Preview -->
  <main class="lab-main">
    <div class="preview-header">
      <h2>Live Preview</h2>
      <button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.add('open')">
        Open Controls
      </button>
    </div>

    <!-- Typography -->
    <section class="preview-section">
      <h3>Typography</h3>
      <div class="typography-preview">
        <div class="type-sample">
          <h4>Display Heading</h4>
          <p>Body text demonstrating the current font settings. The quick brown fox jumps over the lazy dog. <code>const code = "monospace";</code></p>
        </div>
      </div>
    </section>

    <!-- Cards -->
    <section class="preview-section">
      <h3>Cards with Hover Effects</h3>
      <div class="cards-grid">
        <div class="preview-card" id="card-1">
          <h4>Card One</h4>
          <p>Hover to see lift effect</p>
        </div>
        <div class="preview-card" id="card-2">
          <h4>Card Two</h4>
          <p>Hover to see lift effect</p>
        </div>
        <div class="preview-card" id="card-3">
          <h4>Card Three</h4>
          <p>Hover to see lift effect</p>
        </div>
      </div>
    </section>

    <!-- Buttons -->
    <section class="preview-section">
      <h3>Buttons</h3>
      <div class="buttons-preview">
        <button class="preview-btn primary">Primary</button>
        <button class="preview-btn secondary">Secondary</button>
        <button class="preview-btn outline">Outline</button>
      </div>
    </section>

    <!-- Form -->
    <section class="preview-section">
      <h3>Form Elements</h3>
      <div class="form-preview">
        <div class="form-group-preview">
          <label for="demo-input">Text Input</label>
          <input type="text" id="demo-input" placeholder="Enter text...">
        </div>
        <div class="form-group-preview">
          <label for="demo-select">Select</label>
          <select id="demo-select">
            <option>Option One</option>
            <option>Option Two</option>
            <option>Option Three</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Stagger Animation -->
    <section class="preview-section">
      <h3>Stagger Animation</h3>
      <div class="stagger-demo" id="stagger-demo">
        <div class="stagger-item">Item 1</div>
        <div class="stagger-item">Item 2</div>
        <div class="stagger-item">Item 3</div>
        <div class="stagger-item">Item 4</div>
        <div class="stagger-item">Item 5</div>
        <div class="stagger-item">Item 6</div>
      </div>
      <button style="margin-top: var(--space-4); padding: var(--space-2) var(--space-3); font-size: var(--text-sm);" id="replay-stagger">Replay Animation</button>
    </section>

    <!-- Textures -->
    <section class="preview-section">
      <h3>Surface Textures</h3>
      <div class="texture-preview">
        <div class="texture-sample">None</div>
        <div class="texture-sample noise">Noise</div>
        <div class="texture-sample dots">Dots</div>
        <div class="texture-sample lines">Lines</div>
      </div>
    </section>

    <!-- Glass -->
    <section class="preview-section">
      <h3>Glassmorphism</h3>
      <div class="glass-preview">
        <div class="glass-card">
          <h4>Glass Card</h4>
          <p>Frosted glass effect with backdrop-filter blur.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Export Modal -->
  <div class="export-modal" id="export-modal">
    <div class="export-content">
      <div class="export-header">
        <h3>Export Theme CSS</h3>
        <button class="export-close" onclick="document.getElementById('export-modal').classList.remove('open')">&times;</button>
      </div>
      <div class="export-body">
        <pre id="export-code"></pre>
      </div>
      <div class="export-footer">
        <button class="close-btn" onclick="document.getElementById('export-modal').classList.remove('open')">Close</button>
        <button class="copy-btn" id="copy-btn">Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // STATE
    // ============================================
    const state = {
      theme: '',
      mode: 'auto',
      displayFont: 'system',
      bodyFont: 'system',
      hue: 260,
      saturation: 60,
      staggerDelay: 50,
      hoverLift: 2,
      textureOpacity: 3,
      glassBlur: 8,
      borderRadius: 8,
      borderRough: 0
    };

    // ============================================
    // CONTROLS
    // ============================================

    // Theme select
    document.getElementById('theme-select').addEventListener('change', (e) => {
      state.theme = e.target.value;
      if (state.theme) {
        document.body.dataset.theme = state.theme;
      } else {
        delete document.body.dataset.theme;
      }
    });

    // Mode buttons
    document.querySelectorAll('[data-mode]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-mode]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.mode = btn.dataset.mode;
        // Mode logic would go here
      });
    });

    // Display font
    document.getElementById('display-font').addEventListener('change', (e) => {
      state.displayFont = e.target.value;
      const fontMap = {
        'system': 'var(--font-sans)',
        'playfair': '"Playfair Display", Georgia, serif',
        'inter': '"Inter", system-ui, sans-serif'
      };
      document.documentElement.style.setProperty('--font-display', fontMap[e.target.value]);
    });

    // Body font
    document.getElementById('body-font').addEventListener('change', (e) => {
      state.bodyFont = e.target.value;
      const fontMap = {
        'system': 'var(--font-sans)',
        'inter': '"Inter", system-ui, sans-serif'
      };
      document.documentElement.style.setProperty('--font-body-custom', fontMap[e.target.value]);
    });

    // Hue
    const hueSlider = document.getElementById('hue-shift');
    const hueValue = document.getElementById('hue-value');
    hueSlider.addEventListener('input', () => {
      state.hue = hueSlider.value;
      hueValue.textContent = state.hue;
      document.documentElement.style.setProperty('--brand-hue', state.hue);
    });

    // Saturation
    const satSlider = document.getElementById('saturation');
    const satValue = document.getElementById('sat-value');
    satSlider.addEventListener('input', () => {
      state.saturation = satSlider.value;
      satValue.textContent = state.saturation + '%';
      document.documentElement.style.setProperty('--brand-saturation', state.saturation + '%');
    });

    // Stagger delay
    const staggerSlider = document.getElementById('stagger-delay');
    const staggerValue = document.getElementById('stagger-value');
    staggerSlider.addEventListener('input', () => {
      state.staggerDelay = staggerSlider.value;
      staggerValue.textContent = state.staggerDelay + 'ms';
      document.documentElement.style.setProperty('--motion-stagger-delay', state.staggerDelay + 'ms');
    });

    // Hover lift
    const liftSlider = document.getElementById('hover-lift');
    const liftValue = document.getElementById('lift-value');
    liftSlider.addEventListener('input', () => {
      state.hoverLift = liftSlider.value;
      liftValue.textContent = state.hoverLift + 'px';
      document.documentElement.style.setProperty('--motion-hover-transform', `translateY(-${state.hoverLift}px)`);
    });

    // Texture opacity
    const textureSlider = document.getElementById('texture-opacity');
    const textureValue = document.getElementById('texture-value');
    textureSlider.addEventListener('input', () => {
      state.textureOpacity = textureSlider.value;
      textureValue.textContent = state.textureOpacity + '%';
      document.documentElement.style.setProperty('--surface-texture-opacity', state.textureOpacity / 100);
    });

    // Glass blur
    const blurSlider = document.getElementById('glass-blur');
    const blurValue = document.getElementById('blur-value');
    blurSlider.addEventListener('input', () => {
      state.glassBlur = blurSlider.value;
      blurValue.textContent = state.glassBlur + 'px';
      document.documentElement.style.setProperty('--glass-blur', state.glassBlur + 'px');
    });

    // Border radius
    const radiusSlider = document.getElementById('border-radius');
    const radiusValue = document.getElementById('radius-value');
    radiusSlider.addEventListener('input', () => {
      state.borderRadius = radiusSlider.value;
      radiusValue.textContent = (state.borderRadius / 16).toFixed(2) + 'rem';
      document.documentElement.style.setProperty('--radius-m', state.borderRadius + 'px');
    });

    // Border roughness
    document.querySelectorAll('[data-rough]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-rough]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.borderRough = parseInt(btn.dataset.rough);

        // Apply rough filter to cards
        document.querySelectorAll('.preview-card').forEach(card => {
          card.style.filter = state.borderRough ? 'url(#rough-light)' : 'none';
        });
      });
    });

    // Replay stagger animation
    document.getElementById('replay-stagger').addEventListener('click', () => {
      const items = document.querySelectorAll('.stagger-item');
      items.forEach(item => {
        item.style.animation = 'none';
        void item.offsetWidth; // Trigger reflow
        item.style.animation = '';
      });
    });

    // ============================================
    // EXPORT
    // ============================================
    document.getElementById('export-btn').addEventListener('click', () => {
      const css = generateCSS();
      document.getElementById('export-code').textContent = css;
      document.getElementById('export-modal').classList.add('open');
    });

    document.getElementById('copy-btn').addEventListener('click', () => {
      const css = document.getElementById('export-code').textContent;
      navigator.clipboard.writeText(css).then(() => {
        document.getElementById('copy-btn').textContent = 'Copied!';
        setTimeout(() => {
          document.getElementById('copy-btn').textContent = 'Copy to Clipboard';
        }, 2000);
      });
    });

    function generateCSS() {
      return `/* Generated Theme from Theme Lab */
:root {
  /* Colors */
  --brand-hue: ${state.hue};
  --brand-saturation: ${state.saturation}%;

  /* Typography */
  --font-display: ${state.displayFont === 'system' ? 'var(--font-sans)' : state.displayFont === 'playfair' ? '"Playfair Display", Georgia, serif' : '"Inter", system-ui, sans-serif'};

  /* Motion */
  --motion-stagger-delay: ${state.staggerDelay}ms;
  --motion-hover-transform: translateY(-${state.hoverLift}px);

  /* Surfaces */
  --surface-texture-opacity: ${state.textureOpacity / 100};
  --glass-blur: ${state.glassBlur}px;

  /* Borders */
  --radius-m: ${state.borderRadius}px;
}`;
    }
  </script>
</body>
</html>
