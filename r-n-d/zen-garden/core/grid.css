/* ============================================
   VANILLA BREEZE: Grid Identity System
   Semantic HTML-driven layouts - January 2026
   ============================================ */

@layer grid.identity, grid.layouts, grid.responsive, grid.utilities;

/* ============================================
   GRID IDENTITY LAYER
   Semantic elements auto-register grid areas
   ============================================ */
@layer grid.identity {
  
  /* --- Body-level landmarks --- */
  body > header { grid-area: body-header; }
  body > nav { grid-area: body-nav; }
  body > main { grid-area: body-main; }
  body > aside { grid-area: body-aside; }
  body > footer { grid-area: body-footer; }
  
  /* Secondary nav */
  body > nav:nth-of-type(2) { grid-area: body-nav-secondary; }
  
  /* --- Main-level structure --- */
  main > header { grid-area: main-header; }
  main > nav { grid-area: main-nav; }
  main > article { grid-area: main-article; }
  main > section { grid-area: main-section; }
  main > aside { grid-area: main-aside; }
  main > footer { grid-area: main-footer; }
  
  /* --- Article-level structure --- */
  article > header { grid-area: article-header; }
  article > nav { grid-area: article-nav; }
  article > section { grid-area: article-content; }
  article > aside { grid-area: article-aside; }
  article > footer { grid-area: article-footer; }
  
  /* --- Explicit overrides --- */
  [data-grid-area="hero"] { grid-area: hero; }
  [data-grid-area="sidebar"] { grid-area: sidebar; }
  [data-grid-area="content"] { grid-area: content; }
  [data-grid-area="feature"] { grid-area: feature; }
  [data-grid-area="cta"] { grid-area: cta; }
  [data-grid-area="banner"] { grid-area: banner; }
  [data-grid-area="toc"] { grid-area: toc; }
}

/* ============================================
   GRID LAYOUT TEMPLATES
   ============================================ */
@layer grid.layouts {
  
  :root {
    /* Grid templates as tokens */
    --tpl-stack: 
      "body-header" auto
      "body-nav" auto
      "body-main" 1fr
      "body-footer" auto
      / 1fr;
      
    --tpl-sidebar-left:
      "body-header body-header" auto
      "body-nav    body-main"   1fr
      "body-footer body-footer" auto
      / var(--nav-width, 280px) 1fr;
      
    --tpl-sidebar-right:
      "body-header body-header" auto
      "body-main   body-aside"  1fr
      "body-footer body-footer" auto
      / 1fr var(--nav-width, 280px);
      
    --tpl-holy-grail:
      "body-header body-header body-header" auto
      "body-nav    body-main   body-aside"  1fr
      "body-footer body-footer body-footer" auto
      / var(--nav-width, 280px) 1fr var(--nav-width, 280px);
      
    --tpl-app-shell:
      "body-nav body-header" auto
      "body-nav body-main"   1fr
      / auto 1fr;
      
    --tpl-dashboard:
      "body-header body-header" auto
      "body-nav    body-main"   1fr
      / auto 1fr;
  }
  
  /* Base grid setup */
  body[data-layout] {
    display: grid;
    min-height: 100dvh;
    gap: var(--layout-gap, 1rem);
  }
  
  /* === STANDARD LAYOUTS === */
  
  body[data-layout="stack"] {
    grid-template: var(--tpl-stack);
  }
  
  body[data-layout="sidebar-left"] {
    grid-template: var(--tpl-sidebar-left);
  }
  
  body[data-layout="sidebar-right"] {
    grid-template: var(--tpl-sidebar-right);
  }
  
  body[data-layout="holy-grail"] {
    grid-template: var(--tpl-holy-grail);
  }
  
  body[data-layout="app-shell"] {
    grid-template: var(--tpl-app-shell);
    gap: 0;
  }
  
  body[data-layout="dashboard"] {
    grid-template: var(--tpl-dashboard);
    gap: 0;
  }
  
  /* Centered content layout */
  body[data-layout="article"] {
    grid-template:
      "body-header" auto
      "body-main"   1fr
      "body-footer" auto
      / minmax(0, var(--content-max-width, 65ch));
    justify-content: center;
  }
  
  /* Landing page layout */
  body[data-layout="landing"] {
    grid-template:
      "body-header" auto
      "hero"        auto
      "feature"     auto
      "cta"         auto
      "body-footer" auto
      / 1fr;
  }
  
  /* === NESTED LAYOUTS === */
  
  main[data-layout] {
    display: grid;
    gap: var(--content-gap, 1.5rem);
  }
  
  main[data-layout="article-aside"] {
    grid-template:
      "main-article main-aside" 1fr
      / 1fr 280px;
  }
  
  main[data-layout="stack"] {
    grid-template:
      "main-header"  auto
      "main-article" 1fr
      "main-footer"  auto
      / 1fr;
  }
}

/* ============================================
   RESPONSIVE LAYER
   ============================================ */
@layer grid.responsive {
  
  /* Container query support */
  main, article, section, aside {
    container-type: inline-size;
  }
  
  /* === MOBILE-FIRST BREAKPOINTS === */
  
  @media (width < 768px) {
    body[data-layout="sidebar-left"],
    body[data-layout="sidebar-right"],
    body[data-layout="holy-grail"],
    body[data-layout="dashboard"] {
      grid-template: var(--tpl-stack);
    }
    
    body[data-layout="app-shell"] {
      grid-template:
        "body-header" auto
        "body-main"   1fr
        "body-nav"    auto
        / 1fr;
    }
    
    main[data-layout="article-aside"] {
      grid-template:
        "main-article" 1fr
        "main-aside"   auto
        / 1fr;
    }
  }
  
  /* Medium screens */
  @media (width >= 768px) and (width < 1024px) {
    body[data-layout="holy-grail"] {
      grid-template: var(--tpl-sidebar-left);
      
      & > aside {
        grid-area: unset;
        grid-column: 2;
      }
    }
  }
  
  /* Wide screens: constrain */
  @media (width >= 1400px) {
    body[data-layout="holy-grail"],
    body[data-layout="dashboard"] {
      max-width: 1400px;
      margin-inline: auto;
    }
  }
  
  /* Print */
  @media print {
    body[data-layout] {
      display: block;
      
      & > nav,
      & > aside {
        display: none;
      }
    }
  }
}

/* ============================================
   UTILITIES LAYER
   ============================================ */
@layer grid.utilities {
  
  /* Gap modifiers */
  [data-layout][data-gap="none"] { gap: 0; }
  [data-layout][data-gap="xs"] { gap: var(--gap-xs); }
  [data-layout][data-gap="sm"] { gap: var(--gap-sm); }
  [data-layout][data-gap="md"] { gap: var(--gap-md); }
  [data-layout][data-gap="lg"] { gap: var(--gap-lg); }
  [data-layout][data-gap="xl"] { gap: var(--gap-xl); }
  
  /* Full-bleed */
  [data-layout] > [data-bleed] {
    grid-column: 1 / -1;
  }
  
  /* Sticky positioning */
  [data-layout] > nav[data-sticky],
  [data-layout] > aside[data-sticky] {
    position: sticky;
    top: 0;
    align-self: start;
    max-height: 100dvh;
    overflow-y: auto;
  }
  
  [data-layout] > header[data-sticky] {
    position: sticky;
    top: 0;
    z-index: var(--z-sticky, 100);
  }
  
  /* Sidebar states */
  body[data-layout][data-sidebar="collapsed"] {
    --nav-width: var(--sidebar-collapsed, 64px);
  }
  
  body[data-layout][data-sidebar="hidden"] {
    & > nav {
      display: none;
    }
  }
  
  /* Order utilities */
  [data-order="-1"] { order: -1; }
  [data-order="1"] { order: 1; }
  [data-order="99"] { order: 99; }
  
  /* === :has() POWERED ADAPTATIONS === */
  
  /* Adjust layout when nav is absent */
  body[data-layout="sidebar-left"]:not(:has(> nav)) {
    grid-template-columns: 1fr;
  }
  
  /* Adjust when aside present in main */
  main:has(> aside) {
    display: grid;
    grid-template-columns: 1fr var(--sidebar-width, 280px);
    gap: var(--layout-gap);
  }
}
